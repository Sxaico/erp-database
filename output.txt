.gitignore

# dependencias / caches
__pycache__/
*.pyc
node_modules/
*.log

# entornos / secretos locales
api/.env
.env

# datos locales de postgres
pgdata/

# artefactos de editor/OS
.DS_Store
.vscode/
.idea/


---
docker-compose.yml

services:
  postgres:
    image: postgres:16
    container_name: erp_postgres
    environment:
      POSTGRES_DB: erp_db
      POSTGRES_USER: erp_user
      POSTGRES_PASSWORD: erp_password123
      TZ: America/Argentina/Buenos_Aires
    ports:
      - "5432:5432"
    volumes:
      - ./pgdata:/var/lib/postgresql/data
      - ./init-scripts:/docker-entrypoint-initdb.d
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U erp_user -d erp_db"]
      interval: 10s
      timeout: 5s
      retries: 10

  pgadmin:
    image: dpage/pgadmin4:latest
    container_name: erp_pgadmin
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@miempresa.com
      PGADMIN_DEFAULT_PASSWORD: admin123
      TZ: America/Argentina/Buenos_Aires
    ports:
      - "8080:80"
    depends_on:
      - postgres

  api:
    build:
      context: ./api
      dockerfile: Dockerfile
    container_name: erp_api
    env_file:
      - ./api/.env
    ports:
      - "8000:8000"
    depends_on:
      postgres:
        condition: service_healthy
    volumes:
      - ./api:/app
  web:
    image: node:20-alpine
    container_name: erp_web
    working_dir: /app
    # CAMBIA a npm install
    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port 5173"
    ports:
      - "5173:5173"
    volumes:
      - ./web:/app
    depends_on:
      - api



---
README.md

# ERP MVP (API + DB + UI)

MVP funcional para gesti√≥n b√°sica de proyectos y tareas, con autenticaci√≥n por roles.  
Stack: **FastAPI + PostgreSQL + pgAdmin + Vite/React** en Docker Compose.

---

## üöÄ Quick Start

```bash
# 1) Clonar el repo
git clone <TU_REPO.git> erp-database
cd erp-database

# 2) Levantar todo
docker compose up -d --build

# 3) Verificar
# API health:
http://localhost:8000/health
# UI m√≠nima:
http://localhost:5173/
# pgAdmin:
http://localhost:8080/
````

> Si cambiaste puertos, aj√∫stalos en `docker-compose.yml`.

---

## üß± Servicios & URLs

| Servicio  | URL                            | Notas                      |
| --------- | ------------------------------ | -------------------------- |
| API       | `http://localhost:8000`        | Docs en `/docs` y `/redoc` |
| Health    | `http://localhost:8000/health` | Estado DB y versi√≥n        |
| UI (Vite) | `http://localhost:5173`        | UI m√≠nima ‚ÄúB‚Äù + Health API |
| pgAdmin   | `http://localhost:8080`        | Ver DB y diagramas         |

**pgAdmin (primera vez)**

* Usuario: `admin@miempresa.com`
* Password: `admin123`
* Agregar servidor:

  * Name: `ERP Postgres`
  * Host: `postgres`
  * Port: `5432`
  * DB: `erp_db`
  * User: `erp_user`
  * Pass: `erp_password123`

---

## üîë Cuentas de prueba (seeds)

| Email                  | Password   | Rol         |
| ---------------------- | ---------- | ----------- |
| `admin@miempresa.com`  | `admin123` | Super Admin |
| `colab1@miempresa.com` | `user123`  | Colaborador |
| `colab2@miempresa.com` | `user123`  | Colaborador |
| `colab3@miempresa.com` | `user123`  | Colaborador |

> Los seeds se cargan con los scripts en `init-scripts/`.
> Si el volumen `./pgdata/` ya exist√≠a, los scripts no se re-ejecutan autom√°ticamente (ver ‚ÄúReset DB‚Äù abajo).

---

## üì¶ Estructura del proyecto (resumen)

```
.
‚îú‚îÄ api/
‚îÇ  ‚îú‚îÄ .env
‚îÇ  ‚îú‚îÄ Dockerfile
‚îÇ  ‚îú‚îÄ requirements.txt
‚îÇ  ‚îî‚îÄ app/
‚îÇ     ‚îú‚îÄ main.py
‚îÇ     ‚îú‚îÄ config.py
‚îÇ     ‚îú‚îÄ database.py
‚îÇ     ‚îú‚îÄ utils/
‚îÇ     ‚îÇ  ‚îú‚îÄ security.py
‚îÇ     ‚îÇ  ‚îî‚îÄ dependencies.py
‚îÇ     ‚îú‚îÄ auth/
‚îÇ     ‚îÇ  ‚îú‚îÄ models.py
‚îÇ     ‚îÇ  ‚îú‚îÄ routes.py
‚îÇ     ‚îÇ  ‚îî‚îÄ schemas.py
‚îÇ     ‚îî‚îÄ projects/
‚îÇ        ‚îú‚îÄ models.py
‚îÇ        ‚îú‚îÄ routes.py
‚îÇ        ‚îî‚îÄ schemas.py
‚îú‚îÄ init-scripts/
‚îÇ  ‚îú‚îÄ 01-schema.sql
‚îÇ  ‚îú‚îÄ 02-datos-iniciales.sql
‚îÇ  ‚îú‚îÄ 03-schema-projects.sql
‚îÇ  ‚îú‚îÄ 04-data-demo.sql
‚îÇ  ‚îú‚îÄ 05-initial-data.sql
‚îÇ  ‚îú‚îÄ 06-fix-admin.sql
‚îÇ  ‚îî‚îÄ 07-sample-collaborators.sql
‚îú‚îÄ docker-compose.yml
‚îî‚îÄ web/  (UI m√≠nima React + Vite)
   ‚îú‚îÄ package.json
   ‚îú‚îÄ index.html
   ‚îú‚îÄ vite.config.ts
   ‚îî‚îÄ src/
      ‚îú‚îÄ main.tsx
      ‚îî‚îÄ App.tsx
```

---

## üîê Endpoints principales

**Auth**

* `POST /api/auth/login` ‚Üí `{ access_token, refresh_token, expires_in, user }`
* `GET /api/auth/me` (Bearer) ‚Üí datos del usuario logueado
* `GET /api/auth/users` (Solo Admin/Super Admin) ‚Üí lista de usuarios

> Nota: El **refresh** est√° planificado. El `refresh_token` viene en la respuesta de login y se activar√° cuando agreguemos `POST /api/auth/refresh`.

**Projects & Tasks**

* `POST /api/projects` (Bearer) ‚Üí crear proyecto
* `GET /api/projects` (Bearer) ‚Üí listar proyectos
* `PATCH /api/projects/{id}` (Bearer) ‚Üí actualizar proyecto
* `POST /api/projects/tasks` (Bearer) ‚Üí crear tarea
* `PATCH /api/projects/tasks/{task_id}` (Bearer) ‚Üí actualizar tarea
* `GET /api/projects/{id}/report/estado` (Bearer) ‚Üí resumen por estado (vista)

---

## üß™ Pruebas r√°pidas (PowerShell)

```powershell
# Login admin
$resp = Invoke-RestMethod -Method POST -Uri "http://localhost:8000/api/auth/login" `
  -ContentType "application/json" `
  -Body '{"email":"admin@miempresa.com","password":"admin123"}'
$AT = $resp.access_token

# Me
Invoke-RestMethod -Method GET -Uri "http://localhost:8000/api/auth/me" `
  -Headers @{ Authorization = "Bearer $AT" } | ConvertTo-Json -Depth 6

# Crear proyecto
$createProjBody = @{ codigo="MVP-0001"; nombre="MVP Demo"; descripcion="Proyecto MVP e2e"; prioridad=2 } | ConvertTo-Json
$proj = Invoke-RestMethod -Method POST -Uri "http://localhost:8000/api/projects" `
  -Headers @{ Authorization = "Bearer $AT" } -ContentType "application/json" -Body $createProjBody
$PROJ_ID = $proj.id

# Crear tareas
$body1 = @{ proyecto_id=$PROJ_ID; titulo="Tarea 1"; descripcion="..."; prioridad=2 } | ConvertTo-Json
$body2 = @{ proyecto_id=$PROJ_ID; titulo="Tarea 2"; descripcion="..."; prioridad=2 } | ConvertTo-Json
$t1 = Invoke-RestMethod -Method POST -Uri "http://localhost:8000/api/projects/tasks" `
  -Headers @{ Authorization = "Bearer $AT" } -ContentType "application/json" -Body $body1
$t2 = Invoke-RestMethod -Method POST -Uri "http://localhost:8000/api/projects/tasks" `
  -Headers @{ Authorization = "Bearer $AT" } -ContentType "application/json" -Body $body2

# Cambiar estado
Invoke-RestMethod -Method PATCH -Uri "http://localhost:8000/api/projects/tasks/$($t1.id)" `
  -Headers @{ Authorization = "Bearer $AT" } -ContentType "application/json" `
  -Body (@{ estado="HECHA" } | ConvertTo-Json)

# Reporte por estado
Invoke-RestMethod -Method GET -Uri "http://localhost:8000/api/projects/$PROJ_ID/report/estado" `
  -Headers @{ Authorization = "Bearer $AT" } | ConvertTo-Json -Depth 6
```

---

## üñ•Ô∏è UI m√≠nima

* `web/` sirve con Vite en `http://localhost:5173/`.
* Muestra un ‚Äúlanding‚Äù con verificaci√≥n del **/health** de la API.
* CORS ya incluye `http://localhost:5173` en `api/.env`.

---

## üêò SQLAlchemy 2.x (nota)

Se usan `loader options` con **atributos de clase** (no strings), p.ej.:

```python
select(Usuario).options(selectinload(Usuario.roles))
```

---

## üß∞ Troubleshooting

* **Puertos ocupados**: cierra procesos locales en `5432`, `8000`, `8080`, `5173` o cambia puertos en `docker-compose.yml`.
* **Scripts de seed no corren**: si el volumen `./pgdata/` ya existe, Postgres no re-ejecuta `init-scripts/`.

  * **Reset DB** (‚ö†Ô∏è borra datos locales):

    ```bash
    docker compose down
    rm -rf ./pgdata
    docker compose up -d --build
    ```
  * **Aplicar script manualmente**:

    ```bash
    docker compose exec postgres psql -U erp_user -d erp_db -f /docker-entrypoint-initdb.d/07-sample-collaborators.sql
    ```
* **Rebuild API**:

  ```bash
  docker compose up -d --build api
  ```
* **Ver logs**:

  ```bash
  docker compose logs -f api
  docker compose logs -f web
  docker compose logs -f postgres
  ```

---

## üó∫Ô∏è Roadmap inmediato (MVP+)

1. **/auth/refresh** (JWT refresh endpoint).
2. **Guardas en UI por rol** (componente ProtectedRoute + ocultar acciones).
3. **Login UI simple** (form + persist token).
4. **Listado de proyectos y tareas** (UI m√≠nima) + cambio de estado.
5. **Reporte b√°sico en UI** (resumen por estado del proyecto).

> Todo esto mantiene el alcance MVP con impacto directo en usabilidad.

---

## üìÑ Licencia

MIT (o la que prefieras).


---
script-copiar-todo.txt

# --- Configuraci√≥n ---
# Nombre del archivo de salida que se crear√° en el directorio ra√≠z.
$outputFile = "output.txt"

# Lista de directorios que se ignorar√°n por completo.
$excludedDirs = @(
    'pgdata',
    'node_modules',
    '__pycache__',
    '.vite',
    '.git',      # Se a√±ade .git por si es un repositorio.
    'dist',      # Se a√±ade dist por si hay builds.
    'build'
)

# Lista de extensiones de archivo que se ignorar√°n.
$excludedExtensions = @(
    '.log',
    '.lock',
    '.svg',
    '.png',
    '.jpg',
    '.jpeg',
    '.gif',
    '.ico'
)


# --- Comienzo del Script ---

# Limpiar el archivo de salida si ya existe.
if (Test-Path $outputFile) {
    Clear-Content $outputFile
}

Write-Host "Generando listado de archivos en '$outputFile'..."

# Obtener la ruta completa del directorio actual para crear rutas relativas.
$rootPath = (Get-Location).Path
if (-not $rootPath.EndsWith('\')) {
    $rootPath += '\'
}
$rootPathLength = $rootPath.Length

# Obtener todos los archivos de forma recursiva.
Get-ChildItem -Path . -Recurse -File | ForEach-Object {
    $file = $_
    $shouldExclude = $false

    # 1. Comprobar si el archivo est√° en un directorio excluido.
    foreach ($dir in $excludedDirs) {
        if ($file.FullName -like "*\$dir\*") {
            $shouldExclude = $true
            break
        }
    }

    # 2. Comprobar si la extensi√≥n del archivo est√° excluida (si no fue ya excluido por directorio).
    if (-not $shouldExclude) {
        if ($excludedExtensions -contains $file.Extension) {
            $shouldExclude = $true
        }
    }

    # 3. Excluir el propio archivo de salida.
    if ($file.Name -eq $outputFile) {
        $shouldExclude = $true
    }

    # Si el archivo no debe ser excluido, procesarlo.
    if (-not $shouldExclude) {
        # Obtener la ruta relativa del archivo.
        $relativePath = $file.FullName.Substring($rootPathLength)

        Write-Host "Procesando: $relativePath"

        # Leer el contenido del archivo. Se a√±ade un try-catch por si es un archivo binario.
        $content = ""
        try {
            $content = Get-Content -Path $file.FullName -Raw -ErrorAction Stop
        } catch {
            $content = "### ERROR: No se pudo leer el contenido del archivo (posiblemente binario). ###"
        }

        # Crear el bloque de texto con el formato solicitado.
        $outputBlock = @"
$relativePath

$content

---
"@

        # A√±adir el bloque al archivo de salida.
        Add-Content -Path $outputFile -Value $outputBlock
    }
}

Write-Host "¬°Proceso completado! El archivo '$outputFile' ha sido creado con √©xito."

---
api\.env

# api/.env
APP_NAME="ERP API"
VERSION="1.0.0"
DESCRIPTION="Sistema de Gesti√≥n Empresarial - API Backend"

DATABASE_URL="postgresql+asyncpg://erp_user:erp_password123@postgres:5432/erp_db"
DATABASE_URL_SYNC="postgresql://erp_user:erp_password123@postgres:5432/erp_db"

HOST="0.0.0.0"
PORT=8000
DEBUG=true

SECRET_KEY="cambia-esto-en-produccion"
ALGORITHM="HS256"
ACCESS_TOKEN_EXPIRE_MINUTES=30

ALLOWED_ORIGINS="http://localhost:3000,http://127.0.0.1:3000,http://localhost:8080,http://127.0.0.1:8080,http://localhost:5173,http://127.0.0.1:5173"

MAX_UPLOAD_SIZE=10485760
ITEMS_PER_PAGE=50


---
api\Dockerfile

# api/Dockerfile
FROM python:3.11-slim

WORKDIR /app

RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential gcc libpq-dev \
 && rm -rf /var/lib/apt/lists/*

COPY requirements.txt ./requirements.txt
RUN pip install -r requirements.txt

COPY app ./app

EXPOSE 8000
CMD ["uvicorn", "app.main:app", "--host","0.0.0.0","--port","8000","--reload"]


---
api\requirements.txt

# FastAPI y servidor
fastapi==0.104.1
uvicorn[standard]==0.24.0

# Base de datos
sqlalchemy==2.0.23
asyncpg==0.29.0
psycopg2-binary==2.9.9

# Autenticaci√≥n y seguridad  
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6

# Validaci√≥n y serializaci√≥n
pydantic==2.5.0
pydantic-settings==2.1.0

# Utilidades
python-dotenv==1.0.0
email-validator==2.1.0

# Desarrollo y testing
pytest==7.4.3
pytest-asyncio==0.21.1
httpx==0.25.2

---
api\app\__init__.py



---
api\app\config.py

# api/app/config.py
from typing import List
from pydantic import Field, AliasChoices
from pydantic_settings import BaseSettings, SettingsConfigDict
import json

DEFAULT_ORIGINS = [
    "http://localhost:3000",
    "http://127.0.0.1:3000",
    "http://localhost:8080",
    "http://127.0.0.1:8080",
]

class Settings(BaseSettings):
    model_config = SettingsConfigDict(
        env_file=".env",
        case_sensitive=True,
        extra="ignore",
    )

    # --- App info ---
    app_name: str = Field("ERP API", validation_alias=AliasChoices("APP_NAME", "app_name"))
    version: str = Field("1.0.0", validation_alias=AliasChoices("VERSION", "version"))
    description: str = Field(
        "Sistema de Gesti√≥n Empresarial - API Backend",
        validation_alias=AliasChoices("DESCRIPTION", "description"),
    )

    # --- DB (ojo: host 'postgres' es el nombre del servicio en docker-compose) ---
    database_url: str = Field(
        "postgresql+asyncpg://erp_user:erp_password123@postgres:5432/erp_db",
        validation_alias=AliasChoices("DATABASE_URL", "database_url")
    )
    database_url_sync: str = Field(
        "postgresql://erp_user:erp_password123@postgres:5432/erp_db",
        validation_alias=AliasChoices("DATABASE_URL_SYNC", "database_url_sync")
    )

    # --- Server ---
    host: str = Field("0.0.0.0", validation_alias=AliasChoices("HOST", "host"))
    port: int = Field(8000, validation_alias=AliasChoices("PORT", "port"))
    debug: bool = Field(True, validation_alias=AliasChoices("DEBUG", "debug"))

    # --- Security ---
    secret_key: str = Field("cambia-esto-en-produccion", validation_alias=AliasChoices("SECRET_KEY", "secret_key"))
    algorithm: str = Field("HS256", validation_alias=AliasChoices("ALGORITHM", "algorithm"))
    access_token_expire_minutes: int = Field(
        30, validation_alias=AliasChoices("ACCESS_TOKEN_EXPIRE_MINUTES", "access_token_expire_minutes")
    )

    # --- CORS ---
    # Leer como string crudo y convertir a lista (soporta JSON o CSV)
    allowed_origins_raw: str = Field(
        "", validation_alias=AliasChoices("ALLOWED_ORIGINS", "allowed_origins")
    )

    # --- Misc ---
    max_upload_size: int = Field(10 * 1024 * 1024, validation_alias=AliasChoices("MAX_UPLOAD_SIZE", "max_upload_size"))
    items_per_page: int = Field(50, validation_alias=AliasChoices("ITEMS_PER_PAGE", "items_per_page"))

    @property
    def allowed_origins(self) -> List[str]:
        v = (self.allowed_origins_raw or "").strip()
        if not v:
            return DEFAULT_ORIGINS
        # 1) intenta JSON
        try:
            data = json.loads(v)
            if isinstance(data, list):
                return [str(x).strip() for x in data if str(x).strip()]
        except Exception:
            pass
        # 2) fallback CSV
        return [s.strip() for s in v.split(",") if s.strip()]

settings = Settings()

def get_database_url() -> str:
    return settings.database_url

def get_database_url_sync() -> str:
    return settings.database_url_sync


---
api\app\database.py

# api/app/database.py
import logging
from sqlalchemy import create_engine, MetaData, text
from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession
from sqlalchemy.orm import sessionmaker, declarative_base
from .config import settings

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# --- Motores ---
async_engine = create_async_engine(
    settings.database_url,
    echo=settings.debug,
    pool_pre_ping=True,
    pool_recycle=300,
)

sync_engine = create_engine(
    settings.database_url_sync,
    echo=settings.debug,
    pool_pre_ping=True,
    pool_recycle=300,
)

# --- Sesiones ---
AsyncSessionLocal = sessionmaker(
    bind=async_engine,
    class_=AsyncSession,
    expire_on_commit=False,
)

SessionLocal = sessionmaker(
    bind=sync_engine,
    autocommit=False,
    autoflush=False,
)

# --- Base & metadata ---
Base = declarative_base()
metadata = MetaData()


async def get_async_db() -> AsyncSession:
    """
    Dependency: sesi√≥n async
    """
    async with AsyncSessionLocal() as session:
        try:
            yield session
            await session.commit()
        except Exception:
            await session.rollback()
            raise


def get_db():
    """
    Dependency: sesi√≥n sync
    """
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()


async def init_db():
    """
    Refleja tablas existentes y valida la conexi√≥n.
    """
    try:
        async with async_engine.begin() as conn:
            # Ejecuta la reflexi√≥n en el hilo sync del engine async
            await conn.run_sync(lambda sc: metadata.reflect(bind=sc))
            logger.info("‚úÖ Conexi√≥n a PostgreSQL OK")
            logger.info(f"üìä Tablas encontradas: {len(metadata.tables)}")
            if metadata.tables:
                logger.info(f"üìã {', '.join(list(metadata.tables.keys()))}")
    except Exception as e:
        logger.error(f"‚ùå Error al conectar/reflejar DB: {e}")
        raise


async def close_db():
    try:
        await async_engine.dispose()
        sync_engine.dispose()
        logger.info("‚úÖ Conexiones DB cerradas")
    except Exception as e:
        logger.error(f"‚ùå Error al cerrar DB: {e}")


async def test_connection() -> bool:
    """
    SELECT 1 usando SQLAlchemy 2.0 (text()).
    """
    try:
        async with AsyncSessionLocal() as session:
            result = await session.execute(text("SELECT 1"))
            return result.scalar() == 1
    except Exception as e:
        logger.error(f"‚ùå Test de conexi√≥n fall√≥: {e}")
        return False


---
api\app\main.py

# api/app/main.py

from fastapi import FastAPI, HTTPException, status
from fastapi.middleware.cors import CORSMiddleware
from fastapi.responses import JSONResponse
from contextlib import asynccontextmanager
from datetime import datetime, timezone
import logging
import uvicorn

from .config import settings
from .database import init_db, close_db, test_connection

# Importar todos los modelos para que SQLAlchemy los registre
from .auth import models as auth_models
from .projects import models as project_models

from .auth.routes import auth_router
from .projects.routes import router as projects_router

logging.basicConfig(level=logging.INFO, format="%(asctime)s - %(name)s - %(levelname)s - %(message)s")
logger = logging.getLogger(__name__)


@asynccontextmanager
async def lifespan(app: FastAPI):
    logger.info("üöÄ Iniciando ERP API...")
    try:
        await init_db()
        if await test_connection():
            logger.info("‚úÖ Base de datos conectada correctamente")
        else:
            logger.error("‚ùå Error en la conexi√≥n a la base de datos")
    except Exception as e:
        logger.error(f"‚ùå Error durante el startup: {str(e)}")
        raise
    logger.info("üéâ ERP API iniciada correctamente")
    yield
    logger.info("üîÑ Cerrando ERP API...")
    await close_db()
    logger.info("‚úÖ ERP API cerrada correctamente")


app = FastAPI(
    title=settings.app_name,
    version=settings.version,
    description=settings.description,
    lifespan=lifespan,
    docs_url="/docs",
    redoc_url="/redoc",
    openapi_url="/openapi.json"
)

app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.allowed_origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)


@app.exception_handler(HTTPException)
async def http_exception_handler(request, exc: HTTPException):
    return JSONResponse(status_code=exc.status_code, content={
        "detail": exc.detail,
        "status_code": exc.status_code,
        "success": False
    })


@app.exception_handler(Exception)
async def general_exception_handler(request, exc: Exception):
    logger.error(f"Error no controlado: {str(exc)}")
    return JSONResponse(status_code=status.HTTP_500_INTERNAL_SERVER_ERROR, content={
        "detail": "Error interno del servidor",
        "status_code": 500,
        "success": False
    })


@app.get("/")
async def root():
    return {
        "message": "ERP System API",
        "version": settings.version,
        "status": "active",
        "docs": "/docs",
        "redoc": "/redoc"
    }


@app.get("/health")
async def health_check():
    try:
        db_status = await test_connection()
        return {
            "status": "healthy" if db_status else "unhealthy",
            "database": "connected" if db_status else "disconnected",
            "version": settings.version,
            "timestamp": datetime.now(timezone.utc).isoformat()
        }
    except Exception as e:
        logger.error(f"Error en health check: {str(e)}")
        return JSONResponse(
            status_code=status.HTTP_503_SERVICE_UNAVAILABLE,
            content={"status": "unhealthy", "database": "error", "error": str(e), "version": settings.version}
        )


# Routers
app.include_router(auth_router, prefix="/api/auth", tags=["Authentication"], responses={401: {"description": "Unauthorized"}, 403: {"description": "Forbidden"}})
app.include_router(projects_router, prefix="/api/projects", tags=["Projects & Tasks"])


def start_server():
    uvicorn.run(
        "app.main:app",
        host=settings.host,
        port=settings.port,
        reload=settings.debug,
        log_level="info"
    )


if __name__ == "__main__":
    start_server()

---
api\app\auth\__init__.py



---
api\app\auth\models.py

"""
Modelos SQLAlchemy para autenticaci√≥n (relaciones desambiguadas)
"""
from sqlalchemy import Column, Integer, String, Boolean, DateTime, Text, ForeignKey
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
from sqlalchemy.sql import func
from ..database import Base
import uuid


class Usuario(Base):
    __tablename__ = "usuarios"

    id = Column(Integer, primary_key=True, index=True)
    uuid = Column(UUID(as_uuid=True), default=uuid.uuid4, unique=True, index=True)
    email = Column(String(255), unique=True, index=True, nullable=False)
    password_hash = Column(String(255), nullable=False)
    nombre = Column(String(100), nullable=False)
    apellido = Column(String(100), nullable=False)
    telefono = Column(String(20))
    activo = Column(Boolean, default=True)
    ultimo_login = Column(DateTime(timezone=True))
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), server_default=func.now(), onupdate=func.now())
    deleted_at = Column(DateTime(timezone=True))

    # ---- Relaciones con Roles ----
    # Asignaciones (tabla puente) para crear/borrar
    usuario_roles = relationship(
        "UsuarioRol",
        back_populates="usuario",
        foreign_keys="UsuarioRol.usuario_id",
        cascade="all, delete-orphan",
        lazy="selectin",
        overlaps="usuario,usuarios,roles"
    )
    # Vista M2M de roles (solo lectura)
    roles = relationship(
        "Rol",
        secondary="usuario_roles",
        primaryjoin="Usuario.id == UsuarioRol.usuario_id",
        secondaryjoin="Rol.id == UsuarioRol.rol_id",
        back_populates="usuarios",
        viewonly=True,
        lazy="selectin",
        overlaps="usuario_roles,usuarios"
    )

    # ---- Relaciones con Departamentos ----
    usuario_departamentos = relationship(
        "UsuarioDepartamento",
        back_populates="usuario",
        foreign_keys="UsuarioDepartamento.usuario_id",
        cascade="all, delete-orphan",
        lazy="selectin",
        overlaps="usuario,usuarios,departamentos"
    )
    departamentos = relationship(
        "Departamento",
        secondary="usuario_departamentos",
        primaryjoin="Usuario.id == UsuarioDepartamento.usuario_id",
        secondaryjoin="Departamento.id == UsuarioDepartamento.departamento_id",
        back_populates="usuarios",
        viewonly=True,
        lazy="selectin",
        overlaps="usuario_departamentos,usuarios"
    )

    def __repr__(self):
        return f"<Usuario(id={self.id}, email='{self.email}', nombre='{self.nombre}')>"

    @property
    def nombre_completo(self) -> str:
        return f"{self.nombre} {self.apellido}"


class Rol(Base):
    __tablename__ = "roles"

    id = Column(Integer, primary_key=True, index=True)
    nombre = Column(String(50), unique=True, nullable=False)
    descripcion = Column(Text)
    activo = Column(Boolean, default=True)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), server_default=func.now(), onupdate=func.now())
    deleted_at = Column(DateTime(timezone=True))

    # Asignaciones (tabla puente)
    usuario_roles = relationship(
        "UsuarioRol",
        back_populates="rol",
        lazy="selectin",
        cascade="all, delete-orphan",
        overlaps="rol,roles,usuarios"
    )
    # Usuarios con este rol (solo lectura)
    usuarios = relationship(
        "Usuario",
        secondary="usuario_roles",
        primaryjoin="Rol.id == UsuarioRol.rol_id",
        secondaryjoin="Usuario.id == UsuarioRol.usuario_id",
        back_populates="roles",
        viewonly=True,
        lazy="selectin",
        overlaps="usuario_roles,roles"
    )

    def __repr__(self):
        return f"<Rol(id={self.id}, nombre='{self.nombre}')>"


class UsuarioRol(Base):
    __tablename__ = "usuario_roles"

    id = Column(Integer, primary_key=True, index=True)
    usuario_id = Column(Integer, ForeignKey("usuarios.id", ondelete="CASCADE"), nullable=False)
    rol_id = Column(Integer, ForeignKey("roles.id", ondelete="CASCADE"), nullable=False)
    asignado_por = Column(Integer, ForeignKey("usuarios.id"))
    created_at = Column(DateTime(timezone=True), server_default=func.now())

    # Relaciones
    usuario = relationship(
        "Usuario",
        foreign_keys=[usuario_id],
        back_populates="usuario_roles",
        overlaps="roles,usuarios"
    )
    rol = relationship(
        "Rol",
        back_populates="usuario_roles",
        overlaps="usuarios,roles"
    )
    asignado_por_usuario = relationship(
        "Usuario",
        foreign_keys=[asignado_por]
    )

    def __repr__(self):
        return f"<UsuarioRol(usuario_id={self.usuario_id}, rol_id={self.rol_id})>"


class Organizacion(Base):
    __tablename__ = "organizaciones"

    id = Column(Integer, primary_key=True, index=True)
    uuid = Column(UUID(as_uuid=True), default=uuid.uuid4, unique=True, index=True)
    nombre = Column(String(255), nullable=False)
    razon_social = Column(String(255))
    rfc = Column(String(20))
    telefono = Column(String(20))
    email = Column(String(255))
    direccion = Column(Text)
    ciudad = Column(String(100))
    estado = Column(String(100))
    codigo_postal = Column(String(10))
    pais = Column(String(100), default="Argentina")
    activa = Column(Boolean, default=True)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), server_default=func.now(), onupdate=func.now())
    deleted_at = Column(DateTime(timezone=True))

    departamentos = relationship("Departamento", back_populates="organizacion", lazy="selectin")

    def __repr__(self):
        return f"<Organizacion(id={self.id}, nombre='{self.nombre}')>"


class Departamento(Base):
    __tablename__ = "departamentos"

    id = Column(Integer, primary_key=True, index=True)
    uuid = Column(UUID(as_uuid=True), default=uuid.uuid4, unique=True, index=True)
    nombre = Column(String(100), nullable=False)
    descripcion = Column(Text)
    organizacion_id = Column(Integer, ForeignKey("organizaciones.id", ondelete="CASCADE"))
    departamento_padre_id = Column(Integer, ForeignKey("departamentos.id"))
    responsable_id = Column(Integer, ForeignKey("usuarios.id"))
    activo = Column(Boolean, default=True)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), server_default=func.now(), onupdate=func.now())
    deleted_at = Column(DateTime(timezone=True))

    organizacion = relationship("Organizacion", back_populates="departamentos", lazy="joined")
    responsable = relationship("Usuario")
    departamento_padre = relationship("Departamento", remote_side="Departamento.id")
    # Asignaciones (tabla puente)
    usuarios_asignaciones = relationship(
        "UsuarioDepartamento",
        back_populates="departamento",
        lazy="selectin",
        cascade="all, delete-orphan",
        overlaps="departamento,usuarios"
    )
    # Usuarios (solo lectura)
    usuarios = relationship(
        "Usuario",
        secondary="usuario_departamentos",
        primaryjoin="Departamento.id == UsuarioDepartamento.departamento_id",
        secondaryjoin="Usuario.id == UsuarioDepartamento.usuario_id",
        back_populates="departamentos",
        viewonly=True,
        lazy="selectin",
        overlaps="usuarios_asignaciones,departamentos"
    )

    def __repr__(self):
        return f"<Departamento(id={self.id}, nombre='{self.nombre}')>"


class UsuarioDepartamento(Base):
    __tablename__ = "usuario_departamentos"

    id = Column(Integer, primary_key=True, index=True)
    usuario_id = Column(Integer, ForeignKey("usuarios.id", ondelete="CASCADE"))
    departamento_id = Column(Integer, ForeignKey("departamentos.id", ondelete="CASCADE"))
    es_responsable = Column(Boolean, default=False)
    created_at = Column(DateTime(timezone=True), server_default=func.now())

    usuario = relationship(
        "Usuario",
        back_populates="usuario_departamentos",
        foreign_keys=[usuario_id],
        overlaps="departamentos,usuarios"
    )
    departamento = relationship(
        "Departamento",
        back_populates="usuarios_asignaciones",
        foreign_keys=[departamento_id],
        overlaps="usuarios,departamentos"
    )

    def __repr__(self):
        return f"<UsuarioDepartamento(usuario_id={self.usuario_id}, departamento_id={self.departamento_id})>"


---
api\app\auth\routes.py

"""
Rutas de autenticaci√≥n
"""
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy.orm import selectinload
from sqlalchemy import select, and_
from datetime import datetime, timezone
from typing import List
import logging

from ..database import get_async_db
from ..utils.security import (
    verify_password, get_password_hash,
    create_access_token, create_refresh_token,
    get_user_id_from_refresh_token
)
from ..utils.dependencies import get_current_active_user, require_roles, get_pagination, Pagination
from ..config import settings
from .models import Usuario, Rol, UsuarioRol
from .schemas import (
    LoginRequest, LoginResponse, UsuarioCreate, UsuarioUpdate, UsuarioResponse,
    MessageResponse, ChangePasswordRequest, RolCreate, RolResponse, RolUpdate,
    RefreshTokenRequest
)
from jose import JWTError
from ..utils.security import verify_password, get_password_hash, create_access_token, create_refresh_token, get_user_id_from_refresh_token
from .schemas import RefreshTokenRequest, TokenRefreshResponse

logger = logging.getLogger(__name__)

auth_router = APIRouter()


@auth_router.post("/login", response_model=LoginResponse)
async def login(
    login_data: LoginRequest,
    db: AsyncSession = Depends(get_async_db)
):
    try:
        stmt = (
            select(Usuario)
            .options(
                selectinload(Usuario.roles),
                selectinload(Usuario.departamentos),
            )
            .where(
                and_(
                    Usuario.email == login_data.email.lower(),
                    Usuario.activo == True
                )
            )
        )

        result = await db.execute(stmt)
        user = result.scalar_one_or_none()

        if not user or not verify_password(login_data.password, user.password_hash):
            raise HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail="Credenciales incorrectas",
                headers={"WWW-Authenticate": "Bearer"},
            )

        user.ultimo_login = datetime.now(timezone.utc)
        await db.commit()

        access_token = create_access_token(data={"sub": str(user.id)})
        refresh_token = create_refresh_token(user.id)

        user_response = UsuarioResponse.model_validate(user)
        logger.info(f"Usuario {user.email} autenticado correctamente")

        return LoginResponse(
            access_token=access_token,
            refresh_token=refresh_token,
            expires_in=settings.access_token_expire_minutes * 60,
            user=user_response
        )

    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"Error en login: {str(e)}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail="Error interno del servidor"
        )


@auth_router.post("/refresh", response_model=TokenRefreshResponse)
async def refresh_token(
    payload: RefreshTokenRequest,
    db: AsyncSession = Depends(get_async_db)
):
    try:
        user_id = get_user_id_from_refresh_token(payload.refresh_token)

        result = await db.execute(
            select(Usuario).where(Usuario.id == user_id, Usuario.activo == True)
        )
        user = result.scalar_one_or_none()
        if not user:
            raise HTTPException(status_code=status.HTTP_401_UNAUTHORIZED, detail="Usuario inv√°lido")

        new_access = create_access_token(data={"sub": str(user.id)})
        return TokenRefreshResponse(
            access_token=new_access,
            expires_in=settings.access_token_expire_minutes * 60,
        )
    except JWTError:
        raise HTTPException(status_code=status.HTTP_401_UNAUTHORIZED, detail="Refresh token inv√°lido o expirado")
    except Exception as e:
        logger.error(f"Error en refresh: {str(e)}")
        raise HTTPException(status_code=status.HTTP_500_INTERNAL_SERVER_ERROR, detail="Error interno del servidor")


@auth_router.get("/me", response_model=UsuarioResponse)
async def get_current_user_info(
    current_user: Usuario = Depends(get_current_active_user)
):
    return UsuarioResponse.model_validate(current_user)


@auth_router.put("/me", response_model=UsuarioResponse)
async def update_current_user(
    user_update: UsuarioUpdate,
    current_user: Usuario = Depends(get_current_active_user),
    db: AsyncSession = Depends(get_async_db)
):
    try:
        update_data = user_update.model_dump(exclude_unset=True)

        for field, value in update_data.items():
            if field == "email":
                stmt = select(Usuario).where(
                    and_(Usuario.email == value.lower(), Usuario.id != current_user.id)
                )
                result = await db.execute(stmt)
                if result.scalar_one_or_none():
                    raise HTTPException(
                        status_code=status.HTTP_400_BAD_REQUEST,
                        detail="El email ya est√° en uso"
                    )
                setattr(current_user, field, value.lower())
            else:
                setattr(current_user, field, value)

        await db.commit()
        await db.refresh(current_user)

        logger.info(f"Usuario {current_user.email} actualizado")
        return UsuarioResponse.model_validate(current_user)

    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"Error al actualizar usuario: {str(e)}")
        await db.rollback()
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail="Error al actualizar usuario"
        )


@auth_router.post("/change-password", response_model=MessageResponse)
async def change_password(
    password_data: ChangePasswordRequest,
    current_user: Usuario = Depends(get_current_active_user),
    db: AsyncSession = Depends(get_async_db)
):
    try:
        if not verify_password(password_data.current_password, current_user.password_hash):
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="Contrase√±a actual incorrecta"
            )

        if password_data.new_password != password_data.confirm_password:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="Las contrase√±as nuevas no coinciden"
            )

        current_user.password_hash = get_password_hash(password_data.new_password)
        await db.commit()

        logger.info(f"Contrase√±a cambiada para usuario {current_user.email}")
        return MessageResponse(message="Contrase√±a actualizada correctamente")

    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"Error al cambiar contrase√±a: {str(e)}")
        await db.rollback()
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail="Error al cambiar contrase√±a"
        )


# ============================================
# GESTI√ìN DE USUARIOS (Solo Admins)
# ============================================

@auth_router.post("/users", response_model=UsuarioResponse)
async def create_user(
    user_data: UsuarioCreate,
    db: AsyncSession = Depends(get_async_db),
    current_user: Usuario = Depends(require_roles("Super Admin", "Admin"))
):
    try:
        if user_data.password != user_data.confirm_password:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="Las contrase√±as no coinciden"
            )

        stmt = select(Usuario).where(Usuario.email == user_data.email.lower())
        result = await db.execute(stmt)
        if result.scalar_one_or_none():
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="El email ya est√° registrado"
            )

        new_user = Usuario(
            email=user_data.email.lower(),
            password_hash=get_password_hash(user_data.password),
            nombre=user_data.nombre,
            apellido=user_data.apellido,
            telefono=user_data.telefono
        )
        db.add(new_user)
        await db.flush()

        # Asignar roles
        for role_id in (user_data.roles or []):
            role = (await db.execute(select(Rol).where(and_(Rol.id == role_id, Rol.activo == True)))).scalar_one_or_none()
            if role:
                db.add(UsuarioRol(usuario_id=new_user.id, rol_id=role_id, asignado_por=current_user.id))

        await db.commit()
        await db.refresh(new_user)

        new_user = (await db.execute(
            select(Usuario)
            .options(selectinload(Usuario.roles), selectinload(Usuario.departamentos))
            .where(Usuario.id == new_user.id))
        ).scalar_one()

        logger.info(f"Usuario creado: {new_user.email} por {current_user.email}")
        return UsuarioResponse.model_validate(new_user)

    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"Error al crear usuario: {str(e)}")
        await db.rollback()
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail="Error al crear usuario"
        )


@auth_router.get("/users", response_model=List[UsuarioResponse])
async def list_users(
    pagination: Pagination = Depends(get_pagination),
    db: AsyncSession = Depends(get_async_db),
    current_user: Usuario = Depends(require_roles("Super Admin", "Admin"))
):
    try:
        stmt = (
            select(Usuario)
            .options(selectinload(Usuario.roles), selectinload(Usuario.departamentos))
            .offset(pagination.offset).limit(pagination.per_page)
        )
        result = await db.execute(stmt)
        users = result.scalars().all()
        return [UsuarioResponse.model_validate(user) for user in users]

    except Exception as e:
        logger.error(f"Error al listar usuarios: {str(e)}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail="Error al obtener usuarios"
        )


# ============================================
# GESTI√ìN DE ROLES
# ============================================

@auth_router.get("/roles", response_model=List[RolResponse])
async def list_roles(
    db: AsyncSession = Depends(get_async_db),
    current_user: Usuario = Depends(get_current_active_user)
):
    try:
        roles = (await db.execute(select(Rol).where(Rol.activo == True))).scalars().all()
        return [RolResponse.model_validate(role) for role in roles]
    except Exception as e:
        logger.error(f"Error al listar roles: {str(e)}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail="Error al obtener roles"
        )


---
api\app\auth\schemas.py

"""
Schemas Pydantic para autenticaci√≥n y validaci√≥n
"""
from pydantic import BaseModel, EmailStr, Field
from typing import Optional, List
from datetime import datetime
import uuid


# ============================================
# SCHEMAS DE AUTENTICACI√ìN
# ============================================

class LoginRequest(BaseModel):
    """Schema para login"""
    email: EmailStr
    password: str = Field(..., min_length=6, description="Contrase√±a m√≠nimo 6 caracteres")


class LoginResponse(BaseModel):
    """Schema de respuesta de login"""
    access_token: str
    refresh_token: str
    token_type: str = "bearer"
    expires_in: int
    user: "UsuarioResponse"


class RefreshTokenRequest(BaseModel):
    """Schema para refresh token"""
    refresh_token: str


class ChangePasswordRequest(BaseModel):
    """Schema para cambio de contrase√±a"""
    current_password: str
    new_password: str = Field(..., min_length=6)
    confirm_password: str


# ============================================
# SCHEMAS DE USUARIO
# ============================================

class UsuarioBase(BaseModel):
    """Schema base de usuario"""
    email: EmailStr
    nombre: str = Field(..., min_length=2, max_length=100)
    apellido: str = Field(..., min_length=2, max_length=100)
    telefono: Optional[str] = Field(None, max_length=20)


class UsuarioCreate(UsuarioBase):
    """Schema para crear usuario"""
    password: str = Field(..., min_length=6, description="Contrase√±a m√≠nimo 6 caracteres")
    confirm_password: str
    roles: Optional[List[int]] = Field(default=[], description="IDs de roles")
    departamentos: Optional[List[int]] = Field(default=[], description="IDs de departamentos")

    class Config:
        json_schema_extra = {
            "example": {
                "email": "usuario@empresa.com",
                "nombre": "Juan",
                "apellido": "P√©rez",
                "telefono": "+52 55 1234-5678",
                "password": "password123",
                "confirm_password": "password123",
                "roles": [3],  # ID del rol "Colaborador"
                "departamentos": [2]  # ID del departamento
            }
        }


class UsuarioUpdate(BaseModel):
    """Schema para actualizar usuario"""
    email: Optional[EmailStr] = None
    nombre: Optional[str] = Field(None, min_length=2, max_length=100)
    apellido: Optional[str] = Field(None, min_length=2, max_length=100)
    telefono: Optional[str] = Field(None, max_length=20)
    activo: Optional[bool] = None


class UsuarioResponse(BaseModel):
    """Schema de respuesta de usuario"""
    id: int
    uuid: uuid.UUID
    email: str
    nombre: str
    apellido: str
    nombre_completo: str
    telefono: Optional[str]
    activo: bool
    ultimo_login: Optional[datetime]
    created_at: datetime
    roles: List["RolResponse"] = []
    departamentos: List["DepartamentoSimple"] = []

    class Config:
        from_attributes = True


# ============================================
# SCHEMAS DE ROL
# ============================================

class RolBase(BaseModel):
    """Schema base de rol"""
    nombre: str = Field(..., min_length=2, max_length=50)
    descripcion: Optional[str] = None


class RolCreate(RolBase):
    """Schema para crear rol"""
    pass


class RolUpdate(BaseModel):
    """Schema para actualizar rol"""
    nombre: Optional[str] = Field(None, min_length=2, max_length=50)
    descripcion: Optional[str] = None
    activo: Optional[bool] = None


class RolResponse(BaseModel):
    """Schema de respuesta de rol"""
    id: int
    nombre: str
    descripcion: Optional[str]
    activo: bool
    created_at: datetime

    class Config:
        from_attributes = True


# ============================================
# SCHEMAS DE ORGANIZACI√ìN
# ============================================

class OrganizacionBase(BaseModel):
    """Schema base de organizaci√≥n"""
    nombre: str = Field(..., min_length=2, max_length=255)
    razon_social: Optional[str] = Field(None, max_length=255)
    rfc: Optional[str] = Field(None, max_length=20)
    telefono: Optional[str] = Field(None, max_length=20)
    email: Optional[EmailStr] = None
    direccion: Optional[str] = None
    ciudad: Optional[str] = Field(None, max_length=100)
    estado: Optional[str] = Field(None, max_length=100)
    codigo_postal: Optional[str] = Field(None, max_length=10)
    pais: str = Field(default="Argentina", max_length=100)


class OrganizacionCreate(OrganizacionBase):
    """Schema para crear organizaci√≥n"""
    pass


class OrganizacionUpdate(BaseModel):
    """Schema para actualizar organizaci√≥n"""
    nombre: Optional[str] = Field(None, min_length=2, max_length=255)
    razon_social: Optional[str] = Field(None, max_length=255)
    rfc: Optional[str] = Field(None, max_length=20)
    telefono: Optional[str] = Field(None, max_length=20)
    email: Optional[EmailStr] = None
    direccion: Optional[str] = None
    ciudad: Optional[str] = Field(None, max_length=100)
    estado: Optional[str] = Field(None, max_length=100)
    codigo_postal: Optional[str] = Field(None, max_length=10)
    pais: Optional[str] = Field(None, max_length=100)
    activa: Optional[bool] = None


class OrganizacionResponse(BaseModel):
    """Schema de respuesta de organizaci√≥n"""
    id: int
    uuid: uuid.UUID
    nombre: str
    razon_social: Optional[str]
    rfc: Optional[str]
    telefono: Optional[str]
    email: Optional[str]
    direccion: Optional[str]
    ciudad: Optional[str]
    estado: Optional[str]
    codigo_postal: Optional[str]
    pais: str
    activa: bool
    created_at: datetime

    class Config:
        from_attributes = True


# ============================================
# SCHEMAS DE DEPARTAMENTO
# ============================================

class DepartamentoBase(BaseModel):
    """Schema base de departamento"""
    nombre: str = Field(..., min_length=2, max_length=100)
    descripcion: Optional[str] = None


class DepartamentoCreate(DepartamentoBase):
    """Schema para crear departamento"""
    organizacion_id: int
    departamento_padre_id: Optional[int] = None
    responsable_id: Optional[int] = None


class DepartamentoUpdate(BaseModel):
    """Schema para actualizar departamento"""
    nombre: Optional[str] = Field(None, min_length=2, max_length=100)
    descripcion: Optional[str] = None
    responsable_id: Optional[int] = None
    activo: Optional[bool] = None


class DepartamentoSimple(BaseModel):
    """Schema simple de departamento"""
    id: int
    nombre: str
    descripcion: Optional[str]

    class Config:
        from_attributes = True


class DepartamentoResponse(BaseModel):
    """Schema de respuesta de departamento"""
    id: int
    uuid: uuid.UUID
    nombre: str
    descripcion: Optional[str]
    organizacion_id: int
    departamento_padre_id: Optional[int]
    responsable_id: Optional[int]
    activo: bool
    created_at: datetime
    responsable: Optional["UsuarioResponse"] = None

    class Config:
        from_attributes = True


# ============================================
# SCHEMAS GENERALES
# ============================================

class MessageResponse(BaseModel):
    """Schema para respuestas de mensaje"""
    message: str
    success: bool = True


class ErrorResponse(BaseModel):
    """Schema para respuestas de error"""
    detail: str
    error_code: Optional[str] = None
    success: bool = False


class PaginatedResponse(BaseModel):
    """Schema para respuestas paginadas"""
    items: List[BaseModel]
    total: int
    page: int = 1
    per_page: int = 50
    pages: int
    has_next: bool
    has_prev: bool


# ============================================
# CONFIGURAR FORWARD REFERENCES
# ============================================
# ... imports y clases previas ...

class TokenRefreshResponse(BaseModel):
    access_token: str
    token_type: str = "bearer"
    expires_in: int


# Actualizar forward references
UsuarioResponse.model_rebuild()
LoginResponse.model_rebuild()
DepartamentoResponse.model_rebuild()


---
api\app\projects\__init__.py

# Exponer router y modelos del m√≥dulo projects
from .routes import router
from .models import Proyecto, Tarea

__all__ = ["router", "Proyecto", "Tarea"]


---
api\app\projects\models.py

from sqlalchemy import Column, Integer, String, Text, Boolean, Date, DateTime, Numeric, ForeignKey
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
from sqlalchemy.sql import func
from ..database import Base
import uuid

class Proyecto(Base):
    __tablename__ = "proyectos"

    id = Column(Integer, primary_key=True, index=True)
    uuid = Column(UUID(as_uuid=True), default=uuid.uuid4, unique=True, index=True)
    codigo = Column(String, unique=True)
    nombre = Column(String, nullable=False)
    descripcion = Column(Text)
    organizacion_id = Column(Integer, ForeignKey("organizaciones.id", ondelete="SET NULL"))
    gerente_proyecto_id = Column(Integer, ForeignKey("usuarios.id", ondelete="SET NULL"))
    sponsor_id = Column(Integer, ForeignKey("usuarios.id", ondelete="SET NULL"))
    prioridad = Column(Integer, default=3)
    estado = Column(String, default="EN_PROGRESO")
    presupuesto_monto = Column(Numeric(14, 2), default=0)
    avance_pct = Column(Numeric(5, 2), default=0)
    fecha_inicio = Column(Date)
    fecha_fin_plan = Column(Date)
    fecha_fin_real = Column(Date)
    activo = Column(Boolean, default=True)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), server_default=func.now(), onupdate=func.now())
    deleted_at = Column(DateTime(timezone=True))

    tareas = relationship("Tarea", back_populates="proyecto")

    def __repr__(self):
        return f"<Proyecto(id={self.id}, nombre='{self.nombre}')>"

class Tarea(Base):
    __tablename__ = "tareas"

    id = Column(Integer, primary_key=True, index=True)
    uuid = Column(UUID(as_uuid=True), default=uuid.uuid4, unique=True, index=True)
    proyecto_id = Column(Integer, ForeignKey("proyectos.id", ondelete="CASCADE"), nullable=False)
    titulo = Column(String, nullable=False)
    descripcion = Column(Text)
    estado = Column(String, default="PENDIENTE")
    prioridad = Column(Integer, default=3)
    asignado_a = Column(Integer, ForeignKey("usuarios.id", ondelete="SET NULL"))
    estimado_horas = Column(Numeric(10, 2), default=0)
    real_horas = Column(Numeric(10, 2), default=0)
    fecha_inicio = Column(Date)
    fecha_fin_plan = Column(Date)
    fecha_fin_real = Column(Date)
    activo = Column(Boolean, default=True)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), server_default=func.now(), onupdate=func.now())
    deleted_at = Column(DateTime(timezone=True))

    proyecto = relationship("Proyecto", back_populates="tareas")

    def __repr__(self):
        return f"<Tarea(id={self.id}, titulo='{self.titulo}')>"


---
api\app\projects\routes.py

# api/app/projects/routes.py
from fastapi import APIRouter, Depends, HTTPException, status, Response
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, text
from typing import Optional, List
from pydantic import BaseModel, EmailStr

from ..database import get_async_db
from ..utils.dependencies import get_current_active_user, require_permissions
from .models import Proyecto, Tarea
from .schemas import (
    ProyectoCreate, ProyectoUpdate, ProyectoResponse,
    TareaCreate, TareaUpdate, TareaResponse, ResumenEstadoItem
)

# IMPORTANTE: mantenemos este nombre porque main.py hace `from .projects import router`
router = APIRouter()

# --------------------------- Helpers de membres√≠a/seguridad ---------------------------

async def _is_admin(db: AsyncSession, user_id: int) -> bool:
    q = text("""
        SELECT 1
        FROM usuario_roles ur
        JOIN roles r ON r.id = ur.rol_id
        WHERE ur.usuario_id = :uid AND r.nombre IN ('Super Admin','Admin')
        LIMIT 1
    """)
    return (await db.execute(q, {"uid": user_id})).scalar() is not None

async def _project_exists(db: AsyncSession, project_id: int) -> bool:
    q = text("SELECT 1 FROM proyectos WHERE id = :pid AND deleted_at IS NULL")
    return (await db.execute(q, {"pid": project_id})).scalar() is not None

async def _is_member(db: AsyncSession, project_id: int, user_id: int) -> bool:
    q = text("SELECT 1 FROM proyecto_miembros WHERE proyecto_id = :pid AND usuario_id = :uid")
    return (await db.execute(q, {"pid": project_id, "uid": user_id})).scalar() is not None

# --------------------------- Proyectos ---------------------------

@router.post("", response_model=ProyectoResponse)
async def create_project(
    data: ProyectoCreate,
    db: AsyncSession = Depends(get_async_db),
    user = Depends(require_permissions("write:projects"))
):
    p = Proyecto(
        codigo=data.codigo,
        nombre=data.nombre,
        descripcion=data.descripcion,
        prioridad=data.prioridad or 3
    )
    db.add(p)
    await db.flush()
    await db.commit()
    await db.refresh(p)
    return ProyectoResponse.model_validate(p)

@router.get("", response_model=list[ProyectoResponse], summary="Listar proyectos visibles")
async def list_projects(
    db: AsyncSession = Depends(get_async_db),
    user = Depends(require_permissions("read:projects"))
):
    # Admin ve todos; colaborador solo los que es miembro
    if await _is_admin(db, user.id):
        result = await db.execute(select(Proyecto).where(Proyecto.deleted_at.is_(None)))
        items = result.scalars().all()
        return [ProyectoResponse.model_validate(i) for i in items]
    else:
        q = text("""
            SELECT id, uuid, codigo, nombre, estado, prioridad, avance_pct, presupuesto_monto
            FROM proyectos p
            WHERE p.deleted_at IS NULL
              AND EXISTS (SELECT 1 FROM proyecto_miembros pm
                          WHERE pm.proyecto_id = p.id AND pm.usuario_id = :uid)
            ORDER BY id
        """)
        rows = (await db.execute(q, {"uid": user.id})).mappings().all()
        return [ProyectoResponse(**dict(r)) for r in rows]

@router.get("/{project_id}", response_model=ProyectoResponse, summary="Obtener proyecto si hay acceso")
async def get_project(
    project_id: int,
    db: AsyncSession = Depends(get_async_db),
    user = Depends(require_permissions("read:projects"))
):
    if not await _project_exists(db, project_id):
        raise HTTPException(status_code=404, detail="Proyecto no encontrado")

    if not (await _is_admin(db, user.id) or await _is_member(db, project_id, user.id)):
        raise HTTPException(status_code=403, detail="Sin acceso a este proyecto")

    result = await db.execute(select(Proyecto).where(Proyecto.id == project_id, Proyecto.deleted_at.is_(None)))
    p = result.scalar_one_or_none()
    if not p:
        raise HTTPException(status_code=404, detail="Proyecto no encontrado")
    return ProyectoResponse.model_validate(p)

@router.patch("/{project_id}", response_model=ProyectoResponse)
async def update_project(
    project_id: int,
    data: ProyectoUpdate,
    db: AsyncSession = Depends(get_async_db),
    user = Depends(require_permissions("write:projects"))
):
    result = await db.execute(select(Proyecto).where(Proyecto.id == project_id, Proyecto.deleted_at.is_(None)))
    p = result.scalar_one_or_none()
    if not p:
        raise HTTPException(status_code=404, detail="Proyecto no encontrado")
    for k, v in data.model_dump(exclude_unset=True).items():
        setattr(p, k, v)
    await db.commit()
    await db.refresh(p)
    return ProyectoResponse.model_validate(p)

# --------------------------- Tareas ---------------------------

@router.post("/tasks", response_model=TareaResponse)
async def create_task(
    data: TareaCreate,
    db: AsyncSession = Depends(get_async_db),
    user = Depends(require_permissions("write:tasks"))
):
    # validar proyecto
    result = await db.execute(select(Proyecto.id).where(Proyecto.id == data.proyecto_id, Proyecto.deleted_at.is_(None)))
    if not result.scalar_one_or_none():
        raise HTTPException(status_code=404, detail="Proyecto no existe")
    t = Tarea(
        proyecto_id=data.proyecto_id,
        titulo=data.titulo,
        descripcion=data.descripcion,
        prioridad=data.prioridad or 3
    )
    db.add(t)
    await db.flush()
    await db.commit()
    await db.refresh(t)
    return TareaResponse.model_validate(t)

@router.get("/{project_id}/tasks", response_model=list[TareaResponse])
async def list_tasks(
    project_id: int,
    db: AsyncSession = Depends(get_async_db),
    user = Depends(require_permissions("read:tasks"))
):
    # Nota: si quieres, puedes aplicar el mismo control de acceso que en get_project
    result = await db.execute(select(Tarea).where(Tarea.proyecto_id == project_id, Tarea.deleted_at.is_(None)))
    items = result.scalars().all()
    return [TareaResponse.model_validate(i) for i in items]

@router.patch("/tasks/{task_id}", response_model=TareaResponse)
async def update_task(
    task_id: int,
    data: TareaUpdate,
    db: AsyncSession = Depends(get_async_db),
    user = Depends(require_permissions("write:tasks"))
):
    result = await db.execute(select(Tarea).where(Tarea.id == task_id, Tarea.deleted_at.is_(None)))
    t = result.scalar_one_or_none()
    if not t:
        raise HTTPException(status_code=404, detail="Tarea no encontrada")
    for k, v in data.model_dump(exclude_unset=True).items():
        setattr(t, k, v)
    await db.commit()
    await db.refresh(t)
    return TareaResponse.model_validate(t)

# --------------------------- Reporte simple (vista) ---------------------------

@router.get("/{project_id}/report/estado", response_model=list[ResumenEstadoItem])
async def resumen_por_estado(
    project_id: int,
    db: AsyncSession = Depends(get_async_db),
    user = Depends(require_permissions("read:reports"))
):
    q = text("""
        SELECT proyecto_id, proyecto, estado, cantidad
        FROM vw_resumen_tareas_por_estado
        WHERE proyecto_id = :pid
        ORDER BY estado
    """)
    result = await db.execute(q, {"pid": project_id})
    rows = result.mappings().all()
    return [ResumenEstadoItem(**dict(r)) for r in rows]

# --------------------------- Miembros del proyecto ---------------------------

class MemberCreate(BaseModel):
    usuario_id: Optional[int] = None
    email: Optional[EmailStr] = None

class MemberOut(BaseModel):
    id: int
    email: EmailStr
    nombre: Optional[str] = None
    apellido: Optional[str] = None
    rol_en_proyecto: str = "MIEMBRO"

@router.get("/{project_id}/members", response_model=List[MemberOut], summary="Listar miembros")
async def list_members(
    project_id: int,
    db: AsyncSession = Depends(get_async_db),
    user = Depends(require_permissions("read:projects"))
):
    if not await _project_exists(db, project_id):
        raise HTTPException(status_code=404, detail="Proyecto no encontrado")
    if not (await _is_admin(db, user.id) or await _is_member(db, project_id, user.id)):
        raise HTTPException(status_code=403, detail="Sin acceso a este proyecto")

    q = text("""
        SELECT u.id, u.email, u.nombre, u.apellido, pm.rol_en_proyecto
        FROM proyecto_miembros pm
        JOIN usuarios u ON u.id = pm.usuario_id
        WHERE pm.proyecto_id = :pid
        ORDER BY u.nombre, u.apellido, u.email
    """)
    rows = (await db.execute(q, {"pid": project_id})).mappings().all()
    return [MemberOut(**dict(r)) for r in rows]

@router.post("/{project_id}/members", response_model=MemberOut, status_code=201, summary="Agregar miembro (solo Admin)")
async def add_member(
    project_id: int,
    payload: MemberCreate,
    db: AsyncSession = Depends(get_async_db),
    user = Depends(require_permissions("write:projects"))
):
    if not await _project_exists(db, project_id):
        raise HTTPException(status_code=404, detail="Proyecto no encontrado")
    if not await _is_admin(db, user.id):
        raise HTTPException(status_code=403, detail="Solo Admin puede agregar miembros")

    usuario_id = payload.usuario_id
    if not usuario_id and payload.email:
        uid = (await db.execute(text("SELECT id FROM usuarios WHERE email=:em"), {"em": payload.email})).scalar()
        if not uid:
            raise HTTPException(status_code=404, detail="Usuario no encontrado")
        usuario_id = uid
    if not usuario_id:
        raise HTTPException(status_code=422, detail="Debes enviar usuario_id o email")

    await db.execute(text("""
        INSERT INTO proyecto_miembros (proyecto_id, usuario_id)
        VALUES (:pid, :uid)
        ON CONFLICT (proyecto_id, usuario_id) DO NOTHING
    """), {"pid": project_id, "uid": usuario_id})
    await db.commit()

    q = text("""
        SELECT u.id, u.email, u.nombre, u.apellido, pm.rol_en_proyecto
        FROM proyecto_miembros pm
        JOIN usuarios u ON u.id = pm.usuario_id
        WHERE pm.proyecto_id = :pid AND pm.usuario_id = :uid
    """)
    row = (await db.execute(q, {"pid": project_id, "uid": usuario_id})).mappings().first()
    return MemberOut(**dict(row))

@router.delete("/{project_id}/members/{usuario_id}", status_code=204, summary="Quitar miembro (solo Admin)")
async def remove_member(
    project_id: int,
    usuario_id: int,
    db: AsyncSession = Depends(get_async_db),
    user = Depends(require_permissions("write:projects"))
):
    if not await _project_exists(db, project_id):
        raise HTTPException(status_code=404, detail="Proyecto no encontrado")
    if not await _is_admin(db, user.id):
        raise HTTPException(status_code=403, detail="Solo Admin puede quitar miembros")

    res = await db.execute(text("""
        DELETE FROM proyecto_miembros
        WHERE proyecto_id = :pid AND usuario_id = :uid
    """), {"pid": project_id, "uid": usuario_id})
    if res.rowcount == 0:
        raise HTTPException(status_code=404, detail="Membres√≠a no encontrada")
    await db.commit()
    return Response(status_code=204)


---
api\app\projects\schemas.py

# api/app/projects/schemas.py
from pydantic import BaseModel, Field
from typing import Optional, Dict, List
from datetime import date
import uuid

class ProyectoCreate(BaseModel):
    codigo: Optional[str] = None
    nombre: str = Field(..., min_length=2)
    descripcion: Optional[str] = None
    prioridad: Optional[int] = 3

class ProyectoUpdate(BaseModel):
    nombre: Optional[str] = None
    descripcion: Optional[str] = None
    prioridad: Optional[int] = None
    estado: Optional[str] = None
    presupuesto_monto: Optional[float] = None
    avance_pct: Optional[float] = None
    fecha_inicio: Optional[date] = None
    fecha_fin_plan: Optional[date] = None
    fecha_fin_real: Optional[date] = None

class ProyectoResponse(BaseModel):
    id: int
    uuid: uuid.UUID
    codigo: Optional[str]
    nombre: str
    estado: str
    prioridad: int
    avance_pct: float | None
    presupuesto_monto: float | None
    class Config:
        from_attributes = True

class TareaCreate(BaseModel):
    proyecto_id: int
    titulo: str
    descripcion: Optional[str] = None
    prioridad: Optional[int] = 3

class TareaUpdate(BaseModel):
    titulo: Optional[str] = None
    descripcion: Optional[str] = None
    prioridad: Optional[int] = None
    estado: Optional[str] = None
    real_horas: Optional[float] = None
    fecha_fin_real: Optional[date] = None

class TareaResponse(BaseModel):
    id: int
    uuid: uuid.UUID
    proyecto_id: int
    titulo: str
    estado: str
    prioridad: int
    real_horas: float | None
    class Config:
        from_attributes = True

class ResumenEstadoItem(BaseModel):
    proyecto_id: int
    proyecto: str
    estado: str
    cantidad: int

# ==== Opcionales de conveniencia ====

class ProyectoSummary(BaseModel):
    proyecto: ProyectoResponse
    total_tareas: int
    por_estado: Dict[str, int]
    tareas: List[TareaResponse]

class ProyectoStateUpdate(BaseModel):
    estado: Optional[str] = None


---
api\app\utils\__init__.py



---
api\app\utils\dependencies.py

# api/app/utils/dependencies.py
from typing import Optional, Callable
import logging
from fastapi import Depends, HTTPException, status
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy.orm import selectinload
from sqlalchemy import select

from ..database import get_async_db
from ..auth.models import Usuario
from ..utils.security import get_user_id_from_token

logger = logging.getLogger(__name__)

security = HTTPBearer(auto_error=True)
optional_security = HTTPBearer(auto_error=False)


async def get_current_user(
    credentials: HTTPAuthorizationCredentials = Depends(security),
    db: AsyncSession = Depends(get_async_db),
) -> Usuario:
    """
    Devuelve el usuario autenticado a partir del token.
    """
    try:
        user_id = get_user_id_from_token(credentials.credentials)

        stmt = (
            select(Usuario)
            .options(
                selectinload(Usuario.roles),
                selectinload(Usuario.departamentos),
            )
            .where(Usuario.id == user_id, Usuario.activo == True)
        )

        result = await db.execute(stmt)
        user = result.scalar_one_or_none()
        if user is None:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail="Usuario no encontrado o inactivo",
            )
        return user
    except HTTPException:
        raise
    except Exception as e:
        logger.exception("Error obteniendo usuario actual: %s", e)
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED, detail="Credenciales inv√°lidas"
        ) from e


async def get_current_active_user(
    current_user: Usuario = Depends(get_current_user),
) -> Usuario:
    if not current_user.activo:
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN, detail="Usuario inactivo"
        )
    return current_user


def require_roles(*required_roles: str) -> Callable[..., Usuario]:
    """
    Dependencia para exigir uno de los roles indicados.
    """
    async def checker(
        current_user: Usuario = Depends(get_current_active_user),
    ) -> Usuario:
        user_roles = [r.nombre for r in current_user.roles if r and r.activo]
        if not any(role in user_roles for role in required_roles):
            raise HTTPException(
                status_code=status.HTTP_403_FORBIDDEN,
                detail=f"Se requiere uno de los roles: {', '.join(required_roles)}",
            )
        return current_user

    return checker


def require_permissions(*permissions: str) -> Callable[..., Usuario]:
    """
    Dependencia sencilla basada en roles -> permisos.
    """
    perm_map = {
        "read:users": ["Admin", "Gerente de Proyecto", "L√≠der de Equipo"],
        "write:users": ["Super Admin", "Admin"],
        "read:projects": ["Admin", "Gerente de Proyecto", "L√≠der de Equipo", "Colaborador"],
        "write:projects": ["Admin", "Gerente de Proyecto"],
        "read:tasks": ["Admin", "Gerente de Proyecto", "L√≠der de Equipo", "Colaborador"],
        "write:tasks": ["Admin", "Gerente de Proyecto", "L√≠der de Equipo"],
        "read:reports": ["Admin", "Gerente de Proyecto"],
        "write:reports": ["Admin", "Gerente de Proyecto"],
    }

    async def checker(
        current_user: Usuario = Depends(get_current_active_user),
    ) -> Usuario:
        user_roles = [r.nombre for r in current_user.roles if r and r.activo]
        if "Super Admin" in user_roles:
            return current_user

        for p in permissions:
            allowed = perm_map.get(p, [])
            if not any(r in user_roles for r in allowed):
                raise HTTPException(
                    status_code=status.HTTP_403_FORBIDDEN,
                    detail=f"Permisos insuficientes. Falta: {p}",
                )
        return current_user

    return checker


async def get_optional_user(
    credentials: Optional[HTTPAuthorizationCredentials] = Depends(optional_security),
    db: AsyncSession = Depends(get_async_db),
) -> Optional[Usuario]:
    """
    Devuelve el usuario si trae token; si no, None.
    """
    if not credentials:
        return None
    try:
        return await get_current_user(credentials, db)
    except Exception:
        return None


class Pagination:
    """
    Paginaci√≥n simple: limita per_page a [1..100]
    """
    def __init__(self, page: int = 1, per_page: int = 50):
        self.page = max(1, page)
        self.per_page = min(max(1, per_page), 100)
        self.offset = (self.page - 1) * self.per_page

    def params(self) -> dict:
        return {"limit": self.per_page, "offset": self.offset}


def get_pagination(page: int = 1, per_page: int = 50) -> Pagination:
    """
    Dependencia que devuelve un objeto Pagination.
    """
    return Pagination(page, per_page)


---
api\app\utils\security.py

# api/app/utils/security.py
from datetime import datetime, timedelta, timezone
from typing import Any, Optional, Dict

from jose import jwt, JWTError
from passlib.context import CryptContext

from ..config import settings

# BCrypt para hash/verify
pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")


def get_password_hash(password: str) -> str:
    return pwd_context.hash(password)


def verify_password(plain_password: str, password_hash: str) -> bool:
    try:
        return pwd_context.verify(plain_password, password_hash)
    except Exception:
        return False


def _jwt_encode(claims: Dict[str, Any]) -> str:
    return jwt.encode(claims, settings.secret_key, algorithm=settings.algorithm)


def _jwt_decode(token: str) -> Dict[str, Any]:
    return jwt.decode(token, settings.secret_key, algorithms=[settings.algorithm])


def create_access_token(data: Dict[str, Any], expires_minutes: Optional[int] = None) -> str:
    to_encode = data.copy()
    exp_minutes = expires_minutes if expires_minutes is not None else settings.access_token_expire_minutes
    expire = datetime.now(timezone.utc) + timedelta(minutes=int(exp_minutes))
    if "sub" in to_encode:
        to_encode["sub"] = str(to_encode["sub"])
    to_encode.update({"exp": expire, "type": "access"})
    return _jwt_encode(to_encode)


def create_refresh_token(user_id: int, days: int = 30) -> str:
    expire = datetime.now(timezone.utc) + timedelta(days=days)
    to_encode = {"sub": str(user_id), "exp": expire, "type": "refresh"}
    return _jwt_encode(to_encode)


def get_user_id_from_token(token: str) -> int:
    try:
        payload = _jwt_decode(token)
        sub = payload.get("sub")
        if sub is None:
            raise JWTError("Token sin 'sub'")
        return int(sub)
    except Exception as e:
        raise JWTError(f"Token inv√°lido: {e}") from e

# api/app/utils/security.py (secci√≥n final ‚Äúrefresh‚Äù)
from jose import JWTError

def get_user_id_from_refresh_token(token: str) -> int:
    try:
        payload = _jwt_decode(token)
        if payload.get("type") != "refresh":
            raise JWTError("Token no es de tipo refresh")
        sub = payload.get("sub")
        if not sub:
            raise JWTError("Refresh token sin 'sub'")
        return int(sub)
    except JWTError:
        raise
    except Exception as e:
        raise JWTError(f"Refresh inv√°lido: {e}") from e


---
init-scripts\01-schema.sql

CREATE EXTENSION IF NOT EXISTS pgcrypto;

-- ===== Usuarios / Roles =====
CREATE TABLE IF NOT EXISTS usuarios (
  id             SERIAL PRIMARY KEY,
  uuid           UUID NOT NULL DEFAULT gen_random_uuid(),
  email          TEXT NOT NULL UNIQUE,
  password_hash  TEXT NOT NULL,
  nombre         TEXT NOT NULL,
  apellido       TEXT NOT NULL,
  telefono       TEXT,
  activo         BOOLEAN NOT NULL DEFAULT TRUE,
  ultimo_login   TIMESTAMPTZ,
  created_at     TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at     TIMESTAMPTZ NOT NULL DEFAULT now(),
  deleted_at     TIMESTAMPTZ
);

CREATE TABLE IF NOT EXISTS roles (
  id          SERIAL PRIMARY KEY,
  nombre      TEXT NOT NULL UNIQUE,
  descripcion TEXT,
  activo      BOOLEAN NOT NULL DEFAULT TRUE,
  created_at  TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at  TIMESTAMPTZ NOT NULL DEFAULT now(),
  deleted_at  TIMESTAMPTZ
);

CREATE TABLE IF NOT EXISTS usuario_roles (
  id           SERIAL PRIMARY KEY,
  usuario_id   INT NOT NULL REFERENCES usuarios(id) ON DELETE CASCADE,
  rol_id       INT NOT NULL REFERENCES roles(id) ON DELETE CASCADE,
  asignado_por INT REFERENCES usuarios(id),
  created_at   TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- garantizar que no se dupliquen asignaciones usuario-rol
CREATE UNIQUE INDEX IF NOT EXISTS uq_usuario_roles_usuario_rol
  ON usuario_roles(usuario_id, rol_id);

-- √çndices √∫tiles
CREATE INDEX IF NOT EXISTS idx_usuarios_email ON usuarios(email);
CREATE INDEX IF NOT EXISTS idx_usuarios_activo ON usuarios(activo) WHERE deleted_at IS NULL;
CREATE INDEX IF NOT EXISTS idx_usuario_roles_usuario ON usuario_roles(usuario_id);
CREATE INDEX IF NOT EXISTS idx_usuario_roles_rol ON usuario_roles(rol_id);

-- ===== Organizaci√≥n / Departamentos =====
CREATE TABLE IF NOT EXISTS organizaciones (
  id            SERIAL PRIMARY KEY,
  uuid          UUID NOT NULL DEFAULT gen_random_uuid(),
  nombre        TEXT NOT NULL,
  razon_social  TEXT,
  rfc           TEXT,
  telefono      TEXT,
  email         TEXT,
  direccion     TEXT,
  ciudad        TEXT,
  estado        TEXT,
  codigo_postal TEXT,
  pais          TEXT NOT NULL DEFAULT 'Argentina',
  activa        BOOLEAN NOT NULL DEFAULT TRUE,
  created_at    TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at    TIMESTAMPTZ NOT NULL DEFAULT now(),
  deleted_at    TIMESTAMPTZ
);

CREATE TABLE IF NOT EXISTS departamentos (
  id                     SERIAL PRIMARY KEY,
  uuid                   UUID NOT NULL DEFAULT gen_random_uuid(),
  nombre                 TEXT NOT NULL,
  descripcion            TEXT,
  organizacion_id        INT REFERENCES organizaciones(id) ON DELETE CASCADE,
  departamento_padre_id  INT REFERENCES departamentos(id),
  responsable_id         INT REFERENCES usuarios(id),
  activo                 BOOLEAN NOT NULL DEFAULT TRUE,
  created_at             TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at             TIMESTAMPTZ NOT NULL DEFAULT now(),
  deleted_at             TIMESTAMPTZ
);

CREATE TABLE IF NOT EXISTS usuario_departamentos (
  id               SERIAL PRIMARY KEY,
  usuario_id       INT REFERENCES usuarios(id) ON DELETE CASCADE,
  departamento_id  INT REFERENCES departamentos(id) ON DELETE CASCADE,
  es_responsable   BOOLEAN NOT NULL DEFAULT FALSE,
  created_at       TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- √çndices parciales para soft delete
CREATE INDEX IF NOT EXISTS idx_orgs_activas ON organizaciones(id) WHERE deleted_at IS NULL;
CREATE INDEX IF NOT EXISTS idx_deptos_activos ON departamentos(id) WHERE deleted_at IS NULL;
CREATE INDEX IF NOT EXISTS idx_usuario_deptos_usuario ON usuario_departamentos(usuario_id);
CREATE INDEX IF NOT EXISTS idx_usuario_deptos_depto ON usuario_departamentos(departamento_id);


---
init-scripts\02-datos-iniciales.sql

-- init-scripts/02-datos-iniciales.sql
-- Este archivo se deja m√≠nimo para evitar duplicar DDL del 01.
CREATE EXTENSION IF NOT EXISTS pgcrypto;


---
init-scripts\03-schema-projects.sql

-- init-scripts/03-schema-projects.sql
CREATE EXTENSION IF NOT EXISTS pgcrypto;

CREATE TABLE IF NOT EXISTS proyectos (
  id                 SERIAL PRIMARY KEY,
  uuid               UUID NOT NULL DEFAULT gen_random_uuid(),
  codigo             TEXT UNIQUE,
  nombre             TEXT NOT NULL,
  descripcion        TEXT,
  organizacion_id    INT REFERENCES organizaciones(id) ON DELETE SET NULL,
  gerente_proyecto_id INT REFERENCES usuarios(id) ON DELETE SET NULL,
  sponsor_id         INT REFERENCES usuarios(id) ON DELETE SET NULL,
  prioridad          SMALLINT NOT NULL DEFAULT 3,
  estado             TEXT NOT NULL DEFAULT 'EN_PROGRESO',
  presupuesto_monto  NUMERIC(14,2) DEFAULT 0,
  avance_pct         NUMERIC(5,2)  DEFAULT 0,
  fecha_inicio       DATE,
  fecha_fin_plan     DATE,
  fecha_fin_real     DATE,
  activo             BOOLEAN NOT NULL DEFAULT TRUE,
  created_at         TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at         TIMESTAMPTZ NOT NULL DEFAULT now(),
  deleted_at         TIMESTAMPTZ
);

CREATE INDEX IF NOT EXISTS idx_proy_codigo ON proyectos(codigo) WHERE deleted_at IS NULL;
CREATE INDEX IF NOT EXISTS idx_proy_estado ON proyectos(estado) WHERE deleted_at IS NULL;

CREATE TABLE IF NOT EXISTS tareas (
  id              SERIAL PRIMARY KEY,
  uuid            UUID NOT NULL DEFAULT gen_random_uuid(),
  proyecto_id     INT NOT NULL REFERENCES proyectos(id) ON DELETE CASCADE,
  titulo          TEXT NOT NULL,
  descripcion     TEXT,
  estado          TEXT NOT NULL DEFAULT 'PENDIENTE',
  prioridad       SMALLINT NOT NULL DEFAULT 3,
  asignado_a      INT REFERENCES usuarios(id) ON DELETE SET NULL,
  estimado_horas  NUMERIC(10,2) DEFAULT 0,
  real_horas      NUMERIC(10,2) DEFAULT 0,
  fecha_inicio    DATE,
  fecha_fin_plan  DATE,
  fecha_fin_real  DATE,
  activo          BOOLEAN NOT NULL DEFAULT TRUE,
  created_at      TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at      TIMESTAMPTZ NOT NULL DEFAULT now(),
  deleted_at      TIMESTAMPTZ
);

CREATE INDEX IF NOT EXISTS idx_tareas_proyecto ON tareas(proyecto_id) WHERE deleted_at IS NULL;
CREATE INDEX IF NOT EXISTS idx_tareas_estado ON tareas(estado) WHERE deleted_at IS NULL;

CREATE OR REPLACE VIEW vw_resumen_tareas_por_estado AS
SELECT
  p.id AS proyecto_id,
  p.nombre AS proyecto,
  t.estado,
  COUNT(*)::int AS cantidad
FROM proyectos p
JOIN tareas t ON t.proyecto_id = p.id AND t.deleted_at IS NULL
WHERE p.deleted_at IS NULL
GROUP BY p.id, p.nombre, t.estado
ORDER BY p.id, t.estado;


---
init-scripts\04-data-demo.sql

-- init-scripts/04-data-demo.sql
WITH upsert AS (
  INSERT INTO proyectos (codigo, nombre, estado, prioridad, presupuesto_monto)
  VALUES ('DEMO-2024-001','Implementaci√≥n de Sistema ERP','EN_PROGRESO',2,500000)
  ON CONFLICT (codigo) DO NOTHING
  RETURNING id
)
INSERT INTO tareas (proyecto_id, titulo, estado, prioridad, estimado_horas)
SELECT COALESCE((SELECT id FROM upsert), (SELECT id FROM proyectos WHERE codigo='DEMO-2024-001' LIMIT 1)),
       t.titulo, t.estado, t.prioridad, t.est
FROM (VALUES
  ('An√°lisis de Requerimientos','HECHA',2,16),
  ('Dise√±o de Base de Datos','EN_PROGRESO',2,24),
  ('API de Autenticaci√≥n','EN_PROGRESO',2,20),
  ('Gesti√≥n de Proyectos (CRUD)','PENDIENTE',3,20),
  ('Reporte b√°sico','PENDIENTE',3,12)
) AS t(titulo, estado, prioridad, est);


---
init-scripts\05-initial-data.sql

-- init-scripts/05-initial-data.sql

-- Roles b√°sicos
INSERT INTO roles (nombre, descripcion) VALUES 
('Super Admin', 'Administrador del sistema con todos los permisos'),
('Admin', 'Administrador con permisos de gesti√≥n'),
('Gerente de Proyecto', 'Gestor de proyectos y equipos'),
('L√≠der de Equipo', 'L√≠der de equipos de trabajo'),
('Colaborador', 'Usuario colaborador b√°sico')
ON CONFLICT (nombre) DO NOTHING;

-- Usuario admin inicial (password: admin123) usando pgcrypto (bcrypt)
INSERT INTO usuarios (email, password_hash, nombre, apellido, activo)
VALUES ('admin@miempresa.com', crypt('admin123', gen_salt('bf')), 'Administrador', 'Sistema', TRUE)
ON CONFLICT (email) DO UPDATE
  SET password_hash = EXCLUDED.password_hash,
      nombre = EXCLUDED.nombre,
      apellido = EXCLUDED.apellido,
      activo = TRUE;

-- Asignar rol Super Admin al admin
INSERT INTO usuario_roles (usuario_id, rol_id, asignado_por)
SELECT u.id, r.id, u.id
FROM usuarios u
JOIN roles r ON r.nombre = 'Super Admin'
WHERE u.email = 'admin@miempresa.com'
ON CONFLICT (usuario_id, rol_id) DO NOTHING;

-- Organizaci√≥n y Departamento demo
INSERT INTO organizaciones (nombre, razon_social, pais)
VALUES ('Mi Empresa S.A.', 'Mi Empresa Sociedad An√≥nima', 'Argentina')
ON CONFLICT DO NOTHING;

INSERT INTO departamentos (nombre, descripcion, organizacion_id)
SELECT 'Sistemas', 'Departamento de Tecnolog√≠a', o.id
FROM organizaciones o
WHERE o.nombre = 'Mi Empresa S.A.'
ON CONFLICT DO NOTHING;


---
init-scripts\06-fix-admin.sql

-- init-scripts/06-fix-admin.sql
CREATE EXTENSION IF NOT EXISTS pgcrypto;

-- Roles base
INSERT INTO roles (nombre, descripcion) VALUES
('Super Admin','Administrador del sistema con todos los permisos'),
('Admin','Administrador con permisos de gesti√≥n'),
('Gerente de Proyecto','Gestor de proyectos y equipos'),
('L√≠der de Equipo','L√≠der de equipos de trabajo'),
('Colaborador','Usuario colaborador b√°sico')
ON CONFLICT (nombre) DO NOTHING;

-- Admin inicial
INSERT INTO usuarios (email, password_hash, nombre, apellido, activo)
VALUES ('admin@miempresa.com', crypt('admin123', gen_salt('bf')), 'Administrador', 'Sistema', TRUE)
ON CONFLICT (email) DO UPDATE
SET password_hash = EXCLUDED.password_hash,
    nombre = EXCLUDED.nombre,
    apellido = EXCLUDED.apellido,
    activo = TRUE;

-- Rol "Super Admin" para el admin
INSERT INTO usuario_roles (usuario_id, rol_id)
SELECT u.id, r.id
FROM usuarios u
JOIN roles r ON r.nombre = 'Super Admin'
WHERE u.email = 'admin@miempresa.com'
AND NOT EXISTS (
  SELECT 1 FROM usuario_roles ur WHERE ur.usuario_id = u.id AND ur.rol_id = r.id
);


---
init-scripts\07-sample-collaborators.sql

-- 07-sample-collaborators.sql 
CREATE EXTENSION IF NOT EXISTS pgcrypto; 
-- Asegurar rol Colaborador 
INSERT INTO roles (nombre, descripcion) VALUES ('Colaborador','Usuario colaborador b√°sico') ON CONFLICT (nombre) DO NOTHING;
-- Tres cuentas demo (password: user123) 
INSERT INTO usuarios (email, password_hash, nombre, apellido, activo) VALUES 
('colab1@miempresa.com', crypt('user123', gen_salt('bf')), 'Colab', 'Uno', TRUE), 
('colab2@miempresa.com', crypt('user123', gen_salt('bf')), 'Colab', 'Dos', TRUE), 
('colab3@miempresa.com', crypt('user123', gen_salt('bf')), 'Colab', 'Tres', TRUE) 
ON CONFLICT (email) DO NOTHING; 
-- Asignar rol Colaborador 
INSERT INTO usuario_roles (usuario_id, rol_id) 
SELECT u.id, r.id 
FROM usuarios u 
JOIN roles r ON r.nombre='Colaborador' 
WHERE u.email IN ('colab1@miempresa.com','colab2@miempresa.com','colab3@miempresa.com') 
ON CONFLICT (usuario_id, rol_id) DO NOTHING;

---
init-scripts\08-project-membership.sql

-- 08-project-membership.sql
-- Relaci√≥n proyecto <-> usuario (membres√≠as)
CREATE TABLE IF NOT EXISTS proyecto_miembros (
  id SERIAL PRIMARY KEY,
  proyecto_id INTEGER NOT NULL REFERENCES proyectos(id) ON DELETE CASCADE,
  usuario_id INTEGER NOT NULL REFERENCES usuarios(id) ON DELETE CASCADE,
  rol_en_proyecto VARCHAR(30) DEFAULT 'MIEMBRO',
  creado_en TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE (proyecto_id, usuario_id)
);

-- √çndices √∫tiles
CREATE INDEX IF NOT EXISTS idx_proyecto_miembros_proyecto ON proyecto_miembros(proyecto_id);
CREATE INDEX IF NOT EXISTS idx_proyecto_miembros_usuario ON proyecto_miembros(usuario_id);


---
web\index.html

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ERP MVP</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>


---
web\package-lock.json

{
  "name": "erp-mvp-web",
  "version": "0.0.1",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "name": "erp-mvp-web",
      "version": "0.0.1",
      "dependencies": {
        "react": "^18.3.1",
        "react-dom": "^18.3.1",
        "react-router-dom": "^6.26.1"
      },
      "devDependencies": {
        "@types/react": "^18.3.8",
        "@types/react-dom": "^18.3.0",
        "@vitejs/plugin-react": "^4.3.1",
        "typescript": "^5.6.2",
        "vite": "^5.4.1"
      }
    },
    "node_modules/@babel/code-frame": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/code-frame/-/code-frame-7.27.1.tgz",
      "integrity": "sha512-cjQ7ZlQ0Mv3b47hABuTevyTuYN4i+loJKGeV9flcCgIK37cCXRh+L1bd3iBHlynerhQ7BhCkn2BPbQUL+rGqFg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/helper-validator-identifier": "^7.27.1",
        "js-tokens": "^4.0.0",
        "picocolors": "^1.1.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/compat-data": {
      "version": "7.28.4",
      "resolved": "https://registry.npmjs.org/@babel/compat-data/-/compat-data-7.28.4.tgz",
      "integrity": "sha512-YsmSKC29MJwf0gF8Rjjrg5LQCmyh+j/nD8/eP7f+BeoQTKYqs9RoWbjGOdy0+1Ekr68RJZMUOPVQaQisnIo4Rw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/core": {
      "version": "7.28.4",
      "resolved": "https://registry.npmjs.org/@babel/core/-/core-7.28.4.tgz",
      "integrity": "sha512-2BCOP7TN8M+gVDj7/ht3hsaO/B/n5oDbiAyyvnRlNOs+u1o+JWNYTQrmpuNp1/Wq2gcFrI01JAW+paEKDMx/CA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/code-frame": "^7.27.1",
        "@babel/generator": "^7.28.3",
        "@babel/helper-compilation-targets": "^7.27.2",
        "@babel/helper-module-transforms": "^7.28.3",
        "@babel/helpers": "^7.28.4",
        "@babel/parser": "^7.28.4",
        "@babel/template": "^7.27.2",
        "@babel/traverse": "^7.28.4",
        "@babel/types": "^7.28.4",
        "@jridgewell/remapping": "^2.3.5",
        "convert-source-map": "^2.0.0",
        "debug": "^4.1.0",
        "gensync": "^1.0.0-beta.2",
        "json5": "^2.2.3",
        "semver": "^6.3.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/babel"
      }
    },
    "node_modules/@babel/generator": {
      "version": "7.28.3",
      "resolved": "https://registry.npmjs.org/@babel/generator/-/generator-7.28.3.tgz",
      "integrity": "sha512-3lSpxGgvnmZznmBkCRnVREPUFJv2wrv9iAoFDvADJc0ypmdOxdUtcLeBgBJ6zE0PMeTKnxeQzyk0xTBq4Ep7zw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/parser": "^7.28.3",
        "@babel/types": "^7.28.2",
        "@jridgewell/gen-mapping": "^0.3.12",
        "@jridgewell/trace-mapping": "^0.3.28",
        "jsesc": "^3.0.2"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-compilation-targets": {
      "version": "7.27.2",
      "resolved": "https://registry.npmjs.org/@babel/helper-compilation-targets/-/helper-compilation-targets-7.27.2.tgz",
      "integrity": "sha512-2+1thGUUWWjLTYTHZWK1n8Yga0ijBz1XAhUXcKy81rd5g6yh7hGqMp45v7cadSbEHc9G3OTv45SyneRN3ps4DQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/compat-data": "^7.27.2",
        "@babel/helper-validator-option": "^7.27.1",
        "browserslist": "^4.24.0",
        "lru-cache": "^5.1.1",
        "semver": "^6.3.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-globals": {
      "version": "7.28.0",
      "resolved": "https://registry.npmjs.org/@babel/helper-globals/-/helper-globals-7.28.0.tgz",
      "integrity": "sha512-+W6cISkXFa1jXsDEdYA8HeevQT/FULhxzR99pxphltZcVaugps53THCeiWA8SguxxpSp3gKPiuYfSWopkLQ4hw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-module-imports": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-module-imports/-/helper-module-imports-7.27.1.tgz",
      "integrity": "sha512-0gSFWUPNXNopqtIPQvlD5WgXYI5GY2kP2cCvoT8kczjbfcfuIljTbcWrulD1CIPIX2gt1wghbDy08yE1p+/r3w==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/traverse": "^7.27.1",
        "@babel/types": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-module-transforms": {
      "version": "7.28.3",
      "resolved": "https://registry.npmjs.org/@babel/helper-module-transforms/-/helper-module-transforms-7.28.3.tgz",
      "integrity": "sha512-gytXUbs8k2sXS9PnQptz5o0QnpLL51SwASIORY6XaBKF88nsOT0Zw9szLqlSGQDP/4TljBAD5y98p2U1fqkdsw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/helper-module-imports": "^7.27.1",
        "@babel/helper-validator-identifier": "^7.27.1",
        "@babel/traverse": "^7.28.3"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0"
      }
    },
    "node_modules/@babel/helper-plugin-utils": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-plugin-utils/-/helper-plugin-utils-7.27.1.tgz",
      "integrity": "sha512-1gn1Up5YXka3YYAHGKpbideQ5Yjf1tDa9qYcgysz+cNCXukyLl6DjPXhD3VRwSb8c0J9tA4b2+rHEZtc6R0tlw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-string-parser": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-string-parser/-/helper-string-parser-7.27.1.tgz",
      "integrity": "sha512-qMlSxKbpRlAridDExk92nSobyDdpPijUq2DW6oDnUqd0iOGxmQjyqhMIihI9+zv4LPyZdRje2cavWPbCbWm3eA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-validator-identifier": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-validator-identifier/-/helper-validator-identifier-7.27.1.tgz",
      "integrity": "sha512-D2hP9eA+Sqx1kBZgzxZh0y1trbuU+JoDkiEwqhQ36nodYqJwyEIhPSdMNd7lOm/4io72luTPWH20Yda0xOuUow==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-validator-option": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-validator-option/-/helper-validator-option-7.27.1.tgz",
      "integrity": "sha512-YvjJow9FxbhFFKDSuFnVCe2WxXk1zWc22fFePVNEaWJEu8IrZVlda6N0uHwzZrUM1il7NC9Mlp4MaJYbYd9JSg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helpers": {
      "version": "7.28.4",
      "resolved": "https://registry.npmjs.org/@babel/helpers/-/helpers-7.28.4.tgz",
      "integrity": "sha512-HFN59MmQXGHVyYadKLVumYsA9dBFun/ldYxipEjzA4196jpLZd8UjEEBLkbEkvfYreDqJhZxYAWFPtrfhNpj4w==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/template": "^7.27.2",
        "@babel/types": "^7.28.4"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/parser": {
      "version": "7.28.4",
      "resolved": "https://registry.npmjs.org/@babel/parser/-/parser-7.28.4.tgz",
      "integrity": "sha512-yZbBqeM6TkpP9du/I2pUZnJsRMGGvOuIrhjzC1AwHwW+6he4mni6Bp/m8ijn0iOuZuPI2BfkCoSRunpyjnrQKg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/types": "^7.28.4"
      },
      "bin": {
        "parser": "bin/babel-parser.js"
      },
      "engines": {
        "node": ">=6.0.0"
      }
    },
    "node_modules/@babel/plugin-transform-react-jsx-self": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-react-jsx-self/-/plugin-transform-react-jsx-self-7.27.1.tgz",
      "integrity": "sha512-6UzkCs+ejGdZ5mFFC/OCUrv028ab2fp1znZmCZjAOBKiBK2jXD1O+BPSfX8X2qjJ75fZBMSnQn3Rq2mrBJK2mw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-react-jsx-source": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-react-jsx-source/-/plugin-transform-react-jsx-source-7.27.1.tgz",
      "integrity": "sha512-zbwoTsBruTeKB9hSq73ha66iFeJHuaFkUbwvqElnygoNbj/jHRsSeokowZFN3CZ64IvEqcmmkVe89OPXc7ldAw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/template": {
      "version": "7.27.2",
      "resolved": "https://registry.npmjs.org/@babel/template/-/template-7.27.2.tgz",
      "integrity": "sha512-LPDZ85aEJyYSd18/DkjNh4/y1ntkE5KwUHWTiqgRxruuZL2F1yuHligVHLvcHY2vMHXttKFpJn6LwfI7cw7ODw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/code-frame": "^7.27.1",
        "@babel/parser": "^7.27.2",
        "@babel/types": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/traverse": {
      "version": "7.28.4",
      "resolved": "https://registry.npmjs.org/@babel/traverse/-/traverse-7.28.4.tgz",
      "integrity": "sha512-YEzuboP2qvQavAcjgQNVgsvHIDv6ZpwXvcvjmyySP2DIMuByS/6ioU5G9pYrWHM6T2YDfc7xga9iNzYOs12CFQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/code-frame": "^7.27.1",
        "@babel/generator": "^7.28.3",
        "@babel/helper-globals": "^7.28.0",
        "@babel/parser": "^7.28.4",
        "@babel/template": "^7.27.2",
        "@babel/types": "^7.28.4",
        "debug": "^4.3.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/types": {
      "version": "7.28.4",
      "resolved": "https://registry.npmjs.org/@babel/types/-/types-7.28.4.tgz",
      "integrity": "sha512-bkFqkLhh3pMBUQQkpVgWDWq/lqzc2678eUyDlTBhRqhCHFguYYGM0Efga7tYk4TogG/3x0EEl66/OQ+WGbWB/Q==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/helper-string-parser": "^7.27.1",
        "@babel/helper-validator-identifier": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@esbuild/aix-ppc64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/aix-ppc64/-/aix-ppc64-0.21.5.tgz",
      "integrity": "sha512-1SDgH6ZSPTlggy1yI6+Dbkiz8xzpHJEVAlF/AM1tHPLsf5STom9rwtjE4hKAF20FfXXNTFqEYXyJNWh1GiZedQ==",
      "cpu": [
        "ppc64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "aix"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/android-arm": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/android-arm/-/android-arm-0.21.5.tgz",
      "integrity": "sha512-vCPvzSjpPHEi1siZdlvAlsPxXl7WbOVUBBAowWug4rJHb68Ox8KualB+1ocNvT5fjv6wpkX6o/iEpbDrf68zcg==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/android-arm64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/android-arm64/-/android-arm64-0.21.5.tgz",
      "integrity": "sha512-c0uX9VAUBQ7dTDCjq+wdyGLowMdtR/GoC2U5IYk/7D1H1JYC0qseD7+11iMP2mRLN9RcCMRcjC4YMclCzGwS/A==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/android-x64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/android-x64/-/android-x64-0.21.5.tgz",
      "integrity": "sha512-D7aPRUUNHRBwHxzxRvp856rjUHRFW1SdQATKXH2hqA0kAZb1hKmi02OpYRacl0TxIGz/ZmXWlbZgjwWYaCakTA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/darwin-arm64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/darwin-arm64/-/darwin-arm64-0.21.5.tgz",
      "integrity": "sha512-DwqXqZyuk5AiWWf3UfLiRDJ5EDd49zg6O9wclZ7kUMv2WRFr4HKjXp/5t8JZ11QbQfUS6/cRCKGwYhtNAY88kQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/darwin-x64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/darwin-x64/-/darwin-x64-0.21.5.tgz",
      "integrity": "sha512-se/JjF8NlmKVG4kNIuyWMV/22ZaerB+qaSi5MdrXtd6R08kvs2qCN4C09miupktDitvh8jRFflwGFBQcxZRjbw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/freebsd-arm64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/freebsd-arm64/-/freebsd-arm64-0.21.5.tgz",
      "integrity": "sha512-5JcRxxRDUJLX8JXp/wcBCy3pENnCgBR9bN6JsY4OmhfUtIHe3ZW0mawA7+RDAcMLrMIZaf03NlQiX9DGyB8h4g==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/freebsd-x64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/freebsd-x64/-/freebsd-x64-0.21.5.tgz",
      "integrity": "sha512-J95kNBj1zkbMXtHVH29bBriQygMXqoVQOQYA+ISs0/2l3T9/kj42ow2mpqerRBxDJnmkUDCaQT/dfNXWX/ZZCQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/linux-arm": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-arm/-/linux-arm-0.21.5.tgz",
      "integrity": "sha512-bPb5AHZtbeNGjCKVZ9UGqGwo8EUu4cLq68E95A53KlxAPRmUyYv2D6F0uUI65XisGOL1hBP5mTronbgo+0bFcA==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/linux-arm64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-arm64/-/linux-arm64-0.21.5.tgz",
      "integrity": "sha512-ibKvmyYzKsBeX8d8I7MH/TMfWDXBF3db4qM6sy+7re0YXya+K1cem3on9XgdT2EQGMu4hQyZhan7TeQ8XkGp4Q==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/linux-ia32": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-ia32/-/linux-ia32-0.21.5.tgz",
      "integrity": "sha512-YvjXDqLRqPDl2dvRODYmmhz4rPeVKYvppfGYKSNGdyZkA01046pLWyRKKI3ax8fbJoK5QbxblURkwK/MWY18Tg==",
      "cpu": [
        "ia32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/linux-loong64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-loong64/-/linux-loong64-0.21.5.tgz",
      "integrity": "sha512-uHf1BmMG8qEvzdrzAqg2SIG/02+4/DHB6a9Kbya0XDvwDEKCoC8ZRWI5JJvNdUjtciBGFQ5PuBlpEOXQj+JQSg==",
      "cpu": [
        "loong64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/linux-mips64el": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-mips64el/-/linux-mips64el-0.21.5.tgz",
      "integrity": "sha512-IajOmO+KJK23bj52dFSNCMsz1QP1DqM6cwLUv3W1QwyxkyIWecfafnI555fvSGqEKwjMXVLokcV5ygHW5b3Jbg==",
      "cpu": [
        "mips64el"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/linux-ppc64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-ppc64/-/linux-ppc64-0.21.5.tgz",
      "integrity": "sha512-1hHV/Z4OEfMwpLO8rp7CvlhBDnjsC3CttJXIhBi+5Aj5r+MBvy4egg7wCbe//hSsT+RvDAG7s81tAvpL2XAE4w==",
      "cpu": [
        "ppc64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/linux-riscv64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-riscv64/-/linux-riscv64-0.21.5.tgz",
      "integrity": "sha512-2HdXDMd9GMgTGrPWnJzP2ALSokE/0O5HhTUvWIbD3YdjME8JwvSCnNGBnTThKGEB91OZhzrJ4qIIxk/SBmyDDA==",
      "cpu": [
        "riscv64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/linux-s390x": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-s390x/-/linux-s390x-0.21.5.tgz",
      "integrity": "sha512-zus5sxzqBJD3eXxwvjN1yQkRepANgxE9lgOW2qLnmr8ikMTphkjgXu1HR01K4FJg8h1kEEDAqDcZQtbrRnB41A==",
      "cpu": [
        "s390x"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/linux-x64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-x64/-/linux-x64-0.21.5.tgz",
      "integrity": "sha512-1rYdTpyv03iycF1+BhzrzQJCdOuAOtaqHTWJZCWvijKD2N5Xu0TtVC8/+1faWqcP9iBCWOmjmhoH94dH82BxPQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/netbsd-x64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/netbsd-x64/-/netbsd-x64-0.21.5.tgz",
      "integrity": "sha512-Woi2MXzXjMULccIwMnLciyZH4nCIMpWQAs049KEeMvOcNADVxo0UBIQPfSmxB3CWKedngg7sWZdLvLczpe0tLg==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "netbsd"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/openbsd-x64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/openbsd-x64/-/openbsd-x64-0.21.5.tgz",
      "integrity": "sha512-HLNNw99xsvx12lFBUwoT8EVCsSvRNDVxNpjZ7bPn947b8gJPzeHWyNVhFsaerc0n3TsbOINvRP2byTZ5LKezow==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "openbsd"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/sunos-x64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/sunos-x64/-/sunos-x64-0.21.5.tgz",
      "integrity": "sha512-6+gjmFpfy0BHU5Tpptkuh8+uw3mnrvgs+dSPQXQOv3ekbordwnzTVEb4qnIvQcYXq6gzkyTnoZ9dZG+D4garKg==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "sunos"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/win32-arm64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/win32-arm64/-/win32-arm64-0.21.5.tgz",
      "integrity": "sha512-Z0gOTd75VvXqyq7nsl93zwahcTROgqvuAcYDUr+vOv8uHhNSKROyU961kgtCD1e95IqPKSQKH7tBTslnS3tA8A==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/win32-ia32": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/win32-ia32/-/win32-ia32-0.21.5.tgz",
      "integrity": "sha512-SWXFF1CL2RVNMaVs+BBClwtfZSvDgtL//G/smwAc5oVK/UPu2Gu9tIaRgFmYFFKrmg3SyAjSrElf0TiJ1v8fYA==",
      "cpu": [
        "ia32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@esbuild/win32-x64": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/@esbuild/win32-x64/-/win32-x64-0.21.5.tgz",
      "integrity": "sha512-tQd/1efJuzPC6rCFwEvLtci/xNFcTZknmXs98FYDfGE4wP9ClFV98nyKrzJKVPMhdDnjzLhdUyMX4PsQAPjwIw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@jridgewell/gen-mapping": {
      "version": "0.3.13",
      "resolved": "https://registry.npmjs.org/@jridgewell/gen-mapping/-/gen-mapping-0.3.13.tgz",
      "integrity": "sha512-2kkt/7niJ6MgEPxF0bYdQ6etZaA+fQvDcLKckhy1yIQOzaoKjBBjSj63/aLVjYE3qhRt5dvM+uUyfCg6UKCBbA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/sourcemap-codec": "^1.5.0",
        "@jridgewell/trace-mapping": "^0.3.24"
      }
    },
    "node_modules/@jridgewell/remapping": {
      "version": "2.3.5",
      "resolved": "https://registry.npmjs.org/@jridgewell/remapping/-/remapping-2.3.5.tgz",
      "integrity": "sha512-LI9u/+laYG4Ds1TDKSJW2YPrIlcVYOwi2fUC6xB43lueCjgxV4lffOCZCtYFiH6TNOX+tQKXx97T4IKHbhyHEQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/gen-mapping": "^0.3.5",
        "@jridgewell/trace-mapping": "^0.3.24"
      }
    },
    "node_modules/@jridgewell/resolve-uri": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/@jridgewell/resolve-uri/-/resolve-uri-3.1.2.tgz",
      "integrity": "sha512-bRISgCIjP20/tbWSPWMEi54QVPRZExkuD9lJL+UIxUKtwVJA8wW1Trb1jMs1RFXo1CBTNZ/5hpC9QvmKWdopKw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.0.0"
      }
    },
    "node_modules/@jridgewell/sourcemap-codec": {
      "version": "1.5.5",
      "resolved": "https://registry.npmjs.org/@jridgewell/sourcemap-codec/-/sourcemap-codec-1.5.5.tgz",
      "integrity": "sha512-cYQ9310grqxueWbl+WuIUIaiUaDcj7WOq5fVhEljNVgRfOUhY9fy2zTvfoqWsnebh8Sl70VScFbICvJnLKB0Og==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@jridgewell/trace-mapping": {
      "version": "0.3.30",
      "resolved": "https://registry.npmjs.org/@jridgewell/trace-mapping/-/trace-mapping-0.3.30.tgz",
      "integrity": "sha512-GQ7Nw5G2lTu/BtHTKfXhKHok2WGetd4XYcVKGx00SjAk8GMwgJM3zr6zORiPGuOE+/vkc90KtTosSSvaCjKb2Q==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/resolve-uri": "^3.1.0",
        "@jridgewell/sourcemap-codec": "^1.4.14"
      }
    },
    "node_modules/@remix-run/router": {
      "version": "1.23.0",
      "resolved": "https://registry.npmjs.org/@remix-run/router/-/router-1.23.0.tgz",
      "integrity": "sha512-O3rHJzAQKamUz1fvE0Qaw0xSFqsA/yafi2iqeE0pvdFtCO1viYx8QL6f3Ln/aCCTLxs68SLf0KPM9eSeM8yBnA==",
      "license": "MIT",
      "engines": {
        "node": ">=14.0.0"
      }
    },
    "node_modules/@rolldown/pluginutils": {
      "version": "1.0.0-beta.27",
      "resolved": "https://registry.npmjs.org/@rolldown/pluginutils/-/pluginutils-1.0.0-beta.27.tgz",
      "integrity": "sha512-+d0F4MKMCbeVUJwG96uQ4SgAznZNSq93I3V+9NHA4OpvqG8mRCpGdKmK8l/dl02h2CCDHwW2FqilnTyDcAnqjA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@rollup/rollup-android-arm-eabi": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-android-arm-eabi/-/rollup-android-arm-eabi-4.50.0.tgz",
      "integrity": "sha512-lVgpeQyy4fWN5QYebtW4buT/4kn4p4IJ+kDNB4uYNT5b8c8DLJDg6titg20NIg7E8RWwdWZORW6vUFfrLyG3KQ==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ]
    },
    "node_modules/@rollup/rollup-android-arm64": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-android-arm64/-/rollup-android-arm64-4.50.0.tgz",
      "integrity": "sha512-2O73dR4Dc9bp+wSYhviP6sDziurB5/HCym7xILKifWdE9UsOe2FtNcM+I4xZjKrfLJnq5UR8k9riB87gauiQtw==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ]
    },
    "node_modules/@rollup/rollup-darwin-arm64": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-darwin-arm64/-/rollup-darwin-arm64-4.50.0.tgz",
      "integrity": "sha512-vwSXQN8T4sKf1RHr1F0s98Pf8UPz7pS6P3LG9NSmuw0TVh7EmaE+5Ny7hJOZ0M2yuTctEsHHRTMi2wuHkdS6Hg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ]
    },
    "node_modules/@rollup/rollup-darwin-x64": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-darwin-x64/-/rollup-darwin-x64-4.50.0.tgz",
      "integrity": "sha512-cQp/WG8HE7BCGyFVuzUg0FNmupxC+EPZEwWu2FCGGw5WDT1o2/YlENbm5e9SMvfDFR6FRhVCBePLqj0o8MN7Vw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ]
    },
    "node_modules/@rollup/rollup-freebsd-arm64": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-freebsd-arm64/-/rollup-freebsd-arm64-4.50.0.tgz",
      "integrity": "sha512-UR1uTJFU/p801DvvBbtDD7z9mQL8J80xB0bR7DqW7UGQHRm/OaKzp4is7sQSdbt2pjjSS72eAtRh43hNduTnnQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ]
    },
    "node_modules/@rollup/rollup-freebsd-x64": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-freebsd-x64/-/rollup-freebsd-x64-4.50.0.tgz",
      "integrity": "sha512-G/DKyS6PK0dD0+VEzH/6n/hWDNPDZSMBmqsElWnCRGrYOb2jC0VSupp7UAHHQ4+QILwkxSMaYIbQ72dktp8pKA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ]
    },
    "node_modules/@rollup/rollup-linux-arm-gnueabihf": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm-gnueabihf/-/rollup-linux-arm-gnueabihf-4.50.0.tgz",
      "integrity": "sha512-u72Mzc6jyJwKjJbZZcIYmd9bumJu7KNmHYdue43vT1rXPm2rITwmPWF0mmPzLm9/vJWxIRbao/jrQmxTO0Sm9w==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-arm-musleabihf": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm-musleabihf/-/rollup-linux-arm-musleabihf-4.50.0.tgz",
      "integrity": "sha512-S4UefYdV0tnynDJV1mdkNawp0E5Qm2MtSs330IyHgaccOFrwqsvgigUD29uT+B/70PDY1eQ3t40+xf6wIvXJyg==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-arm64-gnu": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm64-gnu/-/rollup-linux-arm64-gnu-4.50.0.tgz",
      "integrity": "sha512-1EhkSvUQXJsIhk4msxP5nNAUWoB4MFDHhtc4gAYvnqoHlaL9V3F37pNHabndawsfy/Tp7BPiy/aSa6XBYbaD1g==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-arm64-musl": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm64-musl/-/rollup-linux-arm64-musl-4.50.0.tgz",
      "integrity": "sha512-EtBDIZuDtVg75xIPIK1l5vCXNNCIRM0OBPUG+tbApDuJAy9mKago6QxX+tfMzbCI6tXEhMuZuN1+CU8iDW+0UQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-loongarch64-gnu": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-loongarch64-gnu/-/rollup-linux-loongarch64-gnu-4.50.0.tgz",
      "integrity": "sha512-BGYSwJdMP0hT5CCmljuSNx7+k+0upweM2M4YGfFBjnFSZMHOLYR0gEEj/dxyYJ6Zc6AiSeaBY8dWOa11GF/ppQ==",
      "cpu": [
        "loong64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-ppc64-gnu": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-ppc64-gnu/-/rollup-linux-ppc64-gnu-4.50.0.tgz",
      "integrity": "sha512-I1gSMzkVe1KzAxKAroCJL30hA4DqSi+wGc5gviD0y3IL/VkvcnAqwBf4RHXHyvH66YVHxpKO8ojrgc4SrWAnLg==",
      "cpu": [
        "ppc64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-riscv64-gnu": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-riscv64-gnu/-/rollup-linux-riscv64-gnu-4.50.0.tgz",
      "integrity": "sha512-bSbWlY3jZo7molh4tc5dKfeSxkqnf48UsLqYbUhnkdnfgZjgufLS/NTA8PcP/dnvct5CCdNkABJ56CbclMRYCA==",
      "cpu": [
        "riscv64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-riscv64-musl": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-riscv64-musl/-/rollup-linux-riscv64-musl-4.50.0.tgz",
      "integrity": "sha512-LSXSGumSURzEQLT2e4sFqFOv3LWZsEF8FK7AAv9zHZNDdMnUPYH3t8ZlaeYYZyTXnsob3htwTKeWtBIkPV27iQ==",
      "cpu": [
        "riscv64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-s390x-gnu": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-s390x-gnu/-/rollup-linux-s390x-gnu-4.50.0.tgz",
      "integrity": "sha512-CxRKyakfDrsLXiCyucVfVWVoaPA4oFSpPpDwlMcDFQvrv3XY6KEzMtMZrA+e/goC8xxp2WSOxHQubP8fPmmjOQ==",
      "cpu": [
        "s390x"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-x64-gnu": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-x64-gnu/-/rollup-linux-x64-gnu-4.50.0.tgz",
      "integrity": "sha512-8PrJJA7/VU8ToHVEPu14FzuSAqVKyo5gg/J8xUerMbyNkWkO9j2ExBho/68RnJsMGNJq4zH114iAttgm7BZVkA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-x64-musl": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-x64-musl/-/rollup-linux-x64-musl-4.50.0.tgz",
      "integrity": "sha512-SkE6YQp+CzpyOrbw7Oc4MgXFvTw2UIBElvAvLCo230pyxOLmYwRPwZ/L5lBe/VW/qT1ZgND9wJfOsdy0XptRvw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-openharmony-arm64": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-openharmony-arm64/-/rollup-openharmony-arm64-4.50.0.tgz",
      "integrity": "sha512-PZkNLPfvXeIOgJWA804zjSFH7fARBBCpCXxgkGDRjjAhRLOR8o0IGS01ykh5GYfod4c2yiiREuDM8iZ+pVsT+Q==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "openharmony"
      ]
    },
    "node_modules/@rollup/rollup-win32-arm64-msvc": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-win32-arm64-msvc/-/rollup-win32-arm64-msvc-4.50.0.tgz",
      "integrity": "sha512-q7cIIdFvWQoaCbLDUyUc8YfR3Jh2xx3unO8Dn6/TTogKjfwrax9SyfmGGK6cQhKtjePI7jRfd7iRYcxYs93esg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@rollup/rollup-win32-ia32-msvc": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-win32-ia32-msvc/-/rollup-win32-ia32-msvc-4.50.0.tgz",
      "integrity": "sha512-XzNOVg/YnDOmFdDKcxxK410PrcbcqZkBmz+0FicpW5jtjKQxcW1BZJEQOF0NJa6JO7CZhett8GEtRN/wYLYJuw==",
      "cpu": [
        "ia32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@rollup/rollup-win32-x64-msvc": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-win32-x64-msvc/-/rollup-win32-x64-msvc-4.50.0.tgz",
      "integrity": "sha512-xMmiWRR8sp72Zqwjgtf3QbZfF1wdh8X2ABu3EaozvZcyHJeU0r+XAnXdKgs4cCAp6ORoYoCygipYP1mjmbjrsg==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@types/babel__core": {
      "version": "7.20.5",
      "resolved": "https://registry.npmjs.org/@types/babel__core/-/babel__core-7.20.5.tgz",
      "integrity": "sha512-qoQprZvz5wQFJwMDqeseRXWv3rqMvhgpbXFfVyWhbx9X47POIA6i/+dXefEmZKoAgOaTdaIgNSMqMIU61yRyzA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/parser": "^7.20.7",
        "@babel/types": "^7.20.7",
        "@types/babel__generator": "*",
        "@types/babel__template": "*",
        "@types/babel__traverse": "*"
      }
    },
    "node_modules/@types/babel__generator": {
      "version": "7.27.0",
      "resolved": "https://registry.npmjs.org/@types/babel__generator/-/babel__generator-7.27.0.tgz",
      "integrity": "sha512-ufFd2Xi92OAVPYsy+P4n7/U7e68fex0+Ee8gSG9KX7eo084CWiQ4sdxktvdl0bOPupXtVJPY19zk6EwWqUQ8lg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/types": "^7.0.0"
      }
    },
    "node_modules/@types/babel__template": {
      "version": "7.4.4",
      "resolved": "https://registry.npmjs.org/@types/babel__template/-/babel__template-7.4.4.tgz",
      "integrity": "sha512-h/NUaSyG5EyxBIp8YRxo4RMe2/qQgvyowRwVMzhYhBCONbW8PUsg4lkFMrhgZhUe5z3L3MiLDuvyJ/CaPa2A8A==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/parser": "^7.1.0",
        "@babel/types": "^7.0.0"
      }
    },
    "node_modules/@types/babel__traverse": {
      "version": "7.28.0",
      "resolved": "https://registry.npmjs.org/@types/babel__traverse/-/babel__traverse-7.28.0.tgz",
      "integrity": "sha512-8PvcXf70gTDZBgt9ptxJ8elBeBjcLOAcOtoO/mPJjtji1+CdGbHgm77om1GrsPxsiE+uXIpNSK64UYaIwQXd4Q==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/types": "^7.28.2"
      }
    },
    "node_modules/@types/estree": {
      "version": "1.0.8",
      "resolved": "https://registry.npmjs.org/@types/estree/-/estree-1.0.8.tgz",
      "integrity": "sha512-dWHzHa2WqEXI/O1E9OjrocMTKJl2mSrEolh1Iomrv6U+JuNwaHXsXx9bLu5gG7BUWFIN0skIQJQ/L1rIex4X6w==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/prop-types": {
      "version": "15.7.15",
      "resolved": "https://registry.npmjs.org/@types/prop-types/-/prop-types-15.7.15.tgz",
      "integrity": "sha512-F6bEyamV9jKGAFBEmlQnesRPGOQqS2+Uwi0Em15xenOxHaf2hv6L8YCVn3rPdPJOiJfPiCnLIRyvwVaqMY3MIw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/react": {
      "version": "18.3.24",
      "resolved": "https://registry.npmjs.org/@types/react/-/react-18.3.24.tgz",
      "integrity": "sha512-0dLEBsA1kI3OezMBF8nSsb7Nk19ZnsyE1LLhB8r27KbgU5H4pvuqZLdtE+aUkJVoXgTVuA+iLIwmZ0TuK4tx6A==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@types/prop-types": "*",
        "csstype": "^3.0.2"
      }
    },
    "node_modules/@types/react-dom": {
      "version": "18.3.7",
      "resolved": "https://registry.npmjs.org/@types/react-dom/-/react-dom-18.3.7.tgz",
      "integrity": "sha512-MEe3UeoENYVFXzoXEWsvcpg6ZvlrFNlOQ7EOsvhI3CfAXwzPfO8Qwuxd40nepsYKqyyVQnTdEfv68q91yLcKrQ==",
      "dev": true,
      "license": "MIT",
      "peerDependencies": {
        "@types/react": "^18.0.0"
      }
    },
    "node_modules/@vitejs/plugin-react": {
      "version": "4.7.0",
      "resolved": "https://registry.npmjs.org/@vitejs/plugin-react/-/plugin-react-4.7.0.tgz",
      "integrity": "sha512-gUu9hwfWvvEDBBmgtAowQCojwZmJ5mcLn3aufeCsitijs3+f2NsrPtlAWIR6OPiqljl96GVCUbLe0HyqIpVaoA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/core": "^7.28.0",
        "@babel/plugin-transform-react-jsx-self": "^7.27.1",
        "@babel/plugin-transform-react-jsx-source": "^7.27.1",
        "@rolldown/pluginutils": "1.0.0-beta.27",
        "@types/babel__core": "^7.20.5",
        "react-refresh": "^0.17.0"
      },
      "engines": {
        "node": "^14.18.0 || >=16.0.0"
      },
      "peerDependencies": {
        "vite": "^4.2.0 || ^5.0.0 || ^6.0.0 || ^7.0.0"
      }
    },
    "node_modules/browserslist": {
      "version": "4.25.4",
      "resolved": "https://registry.npmjs.org/browserslist/-/browserslist-4.25.4.tgz",
      "integrity": "sha512-4jYpcjabC606xJ3kw2QwGEZKX0Aw7sgQdZCvIK9dhVSPh76BKo+C+btT1RRofH7B+8iNpEbgGNVWiLki5q93yg==",
      "dev": true,
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/browserslist"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/browserslist"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "caniuse-lite": "^1.0.30001737",
        "electron-to-chromium": "^1.5.211",
        "node-releases": "^2.0.19",
        "update-browserslist-db": "^1.1.3"
      },
      "bin": {
        "browserslist": "cli.js"
      },
      "engines": {
        "node": "^6 || ^7 || ^8 || ^9 || ^10 || ^11 || ^12 || >=13.7"
      }
    },
    "node_modules/caniuse-lite": {
      "version": "1.0.30001741",
      "resolved": "https://registry.npmjs.org/caniuse-lite/-/caniuse-lite-1.0.30001741.tgz",
      "integrity": "sha512-QGUGitqsc8ARjLdgAfxETDhRbJ0REsP6O3I96TAth/mVjh2cYzN2u+3AzPP3aVSm2FehEItaJw1xd+IGBXWeSw==",
      "dev": true,
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/browserslist"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/caniuse-lite"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "CC-BY-4.0"
    },
    "node_modules/convert-source-map": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/convert-source-map/-/convert-source-map-2.0.0.tgz",
      "integrity": "sha512-Kvp459HrV2FEJ1CAsi1Ku+MY3kasH19TFykTz2xWmMeq6bk2NU3XXvfJ+Q61m0xktWwt+1HSYf3JZsTms3aRJg==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/csstype": {
      "version": "3.1.3",
      "resolved": "https://registry.npmjs.org/csstype/-/csstype-3.1.3.tgz",
      "integrity": "sha512-M1uQkMl8rQK/szD0LNhtqxIPLpimGm8sOBwU7lLnCpSbTyY3yeU1Vc7l4KT5zT4s/yOxHH5O7tIuuLOCnLADRw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/debug": {
      "version": "4.4.1",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.4.1.tgz",
      "integrity": "sha512-KcKCqiftBJcZr++7ykoDIEwSa3XWowTfNPo92BYxjXiyYEVrUQh2aLyhxBCwww+heortUFxEJYcRzosstTEBYQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/electron-to-chromium": {
      "version": "1.5.214",
      "resolved": "https://registry.npmjs.org/electron-to-chromium/-/electron-to-chromium-1.5.214.tgz",
      "integrity": "sha512-TpvUNdha+X3ybfU78NoQatKvQEm1oq3lf2QbnmCEdw+Bd9RuIAY+hJTvq1avzHM0f7EJfnH3vbCnbzKzisc/9Q==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/esbuild": {
      "version": "0.21.5",
      "resolved": "https://registry.npmjs.org/esbuild/-/esbuild-0.21.5.tgz",
      "integrity": "sha512-mg3OPMV4hXywwpoDxu3Qda5xCKQi+vCTZq8S9J/EpkhB2HzKXq4SNFZE3+NK93JYxc8VMSep+lOUSC/RVKaBqw==",
      "dev": true,
      "hasInstallScript": true,
      "license": "MIT",
      "bin": {
        "esbuild": "bin/esbuild"
      },
      "engines": {
        "node": ">=12"
      },
      "optionalDependencies": {
        "@esbuild/aix-ppc64": "0.21.5",
        "@esbuild/android-arm": "0.21.5",
        "@esbuild/android-arm64": "0.21.5",
        "@esbuild/android-x64": "0.21.5",
        "@esbuild/darwin-arm64": "0.21.5",
        "@esbuild/darwin-x64": "0.21.5",
        "@esbuild/freebsd-arm64": "0.21.5",
        "@esbuild/freebsd-x64": "0.21.5",
        "@esbuild/linux-arm": "0.21.5",
        "@esbuild/linux-arm64": "0.21.5",
        "@esbuild/linux-ia32": "0.21.5",
        "@esbuild/linux-loong64": "0.21.5",
        "@esbuild/linux-mips64el": "0.21.5",
        "@esbuild/linux-ppc64": "0.21.5",
        "@esbuild/linux-riscv64": "0.21.5",
        "@esbuild/linux-s390x": "0.21.5",
        "@esbuild/linux-x64": "0.21.5",
        "@esbuild/netbsd-x64": "0.21.5",
        "@esbuild/openbsd-x64": "0.21.5",
        "@esbuild/sunos-x64": "0.21.5",
        "@esbuild/win32-arm64": "0.21.5",
        "@esbuild/win32-ia32": "0.21.5",
        "@esbuild/win32-x64": "0.21.5"
      }
    },
    "node_modules/escalade": {
      "version": "3.2.0",
      "resolved": "https://registry.npmjs.org/escalade/-/escalade-3.2.0.tgz",
      "integrity": "sha512-WUj2qlxaQtO4g6Pq5c29GTcWGDyd8itL8zTlipgECz3JesAiiOKotd8JU6otB3PACgG6xkJUyVhboMS+bje/jA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/fsevents": {
      "version": "2.3.3",
      "resolved": "https://registry.npmjs.org/fsevents/-/fsevents-2.3.3.tgz",
      "integrity": "sha512-5xoDfX+fL7faATnagmWPpbFtwh/R77WmMMqqHGS65C3vvB0YHrgF+B1YmZ3441tMj5n63k0212XNoJwzlhffQw==",
      "dev": true,
      "hasInstallScript": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": "^8.16.0 || ^10.6.0 || >=11.0.0"
      }
    },
    "node_modules/gensync": {
      "version": "1.0.0-beta.2",
      "resolved": "https://registry.npmjs.org/gensync/-/gensync-1.0.0-beta.2.tgz",
      "integrity": "sha512-3hN7NaskYvMDLQY55gnW3NQ+mesEAepTqlg+VEbj7zzqEMBVNhzcGYYeqFo/TlYz6eQiFcp1HcsCZO+nGgS8zg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/js-tokens": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/js-tokens/-/js-tokens-4.0.0.tgz",
      "integrity": "sha512-RdJUflcE3cUzKiMqQgsCu06FPu9UdIJO0beYbPhHN4k6apgJtifcoCtT9bcxOpYBtpD2kCM6Sbzg4CausW/PKQ==",
      "license": "MIT"
    },
    "node_modules/jsesc": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/jsesc/-/jsesc-3.1.0.tgz",
      "integrity": "sha512-/sM3dO2FOzXjKQhJuo0Q173wf2KOo8t4I8vHy6lF9poUp7bKT0/NHE8fPX23PwfhnykfqnC2xRxOnVw5XuGIaA==",
      "dev": true,
      "license": "MIT",
      "bin": {
        "jsesc": "bin/jsesc"
      },
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/json5": {
      "version": "2.2.3",
      "resolved": "https://registry.npmjs.org/json5/-/json5-2.2.3.tgz",
      "integrity": "sha512-XmOWe7eyHYH14cLdVPoyg+GOH3rYX++KpzrylJwSW98t3Nk+U8XOl8FWKOgwtzdb8lXGf6zYwDUzeHMWfxasyg==",
      "dev": true,
      "license": "MIT",
      "bin": {
        "json5": "lib/cli.js"
      },
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/loose-envify": {
      "version": "1.4.0",
      "resolved": "https://registry.npmjs.org/loose-envify/-/loose-envify-1.4.0.tgz",
      "integrity": "sha512-lyuxPGr/Wfhrlem2CL/UcnUc1zcqKAImBDzukY7Y5F/yQiNdko6+fRLevlw1HgMySw7f611UIY408EtxRSoK3Q==",
      "license": "MIT",
      "dependencies": {
        "js-tokens": "^3.0.0 || ^4.0.0"
      },
      "bin": {
        "loose-envify": "cli.js"
      }
    },
    "node_modules/lru-cache": {
      "version": "5.1.1",
      "resolved": "https://registry.npmjs.org/lru-cache/-/lru-cache-5.1.1.tgz",
      "integrity": "sha512-KpNARQA3Iwv+jTA0utUVVbrh+Jlrr1Fv0e56GGzAFOXN7dk/FviaDW8LHmK52DlcH4WP2n6gI8vN1aesBFgo9w==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "yallist": "^3.0.2"
      }
    },
    "node_modules/ms": {
      "version": "2.1.3",
      "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",
      "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/nanoid": {
      "version": "3.3.11",
      "resolved": "https://registry.npmjs.org/nanoid/-/nanoid-3.3.11.tgz",
      "integrity": "sha512-N8SpfPUnUp1bK+PMYW8qSWdl9U+wwNWI4QKxOYDy9JAro3WMX7p2OeVRF9v+347pnakNevPmiHhNmZ2HbFA76w==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "bin": {
        "nanoid": "bin/nanoid.cjs"
      },
      "engines": {
        "node": "^10 || ^12 || ^13.7 || ^14 || >=15.0.1"
      }
    },
    "node_modules/node-releases": {
      "version": "2.0.20",
      "resolved": "https://registry.npmjs.org/node-releases/-/node-releases-2.0.20.tgz",
      "integrity": "sha512-7gK6zSXEH6neM212JgfYFXe+GmZQM+fia5SsusuBIUgnPheLFBmIPhtFoAQRj8/7wASYQnbDlHPVwY0BefoFgA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/picocolors": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/picocolors/-/picocolors-1.1.1.tgz",
      "integrity": "sha512-xceH2snhtb5M9liqDsmEw56le376mTZkEX/jEb/RxNFyegNul7eNslCXP9FDj/Lcu0X8KEyMceP2ntpaHrDEVA==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/postcss": {
      "version": "8.5.6",
      "resolved": "https://registry.npmjs.org/postcss/-/postcss-8.5.6.tgz",
      "integrity": "sha512-3Ybi1tAuwAP9s0r1UQ2J4n5Y0G05bJkpUIO0/bI9MhwmD70S5aTWbXGBwxHrelT+XM1k6dM0pk+SwNkpTRN7Pg==",
      "dev": true,
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/postcss/"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/postcss"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "nanoid": "^3.3.11",
        "picocolors": "^1.1.1",
        "source-map-js": "^1.2.1"
      },
      "engines": {
        "node": "^10 || ^12 || >=14"
      }
    },
    "node_modules/react": {
      "version": "18.3.1",
      "resolved": "https://registry.npmjs.org/react/-/react-18.3.1.tgz",
      "integrity": "sha512-wS+hAgJShR0KhEvPJArfuPVN1+Hz1t0Y6n5jLrGQbkb4urgPE/0Rve+1kMB1v/oWgHgm4WIcV+i7F2pTVj+2iQ==",
      "license": "MIT",
      "dependencies": {
        "loose-envify": "^1.1.0"
      },
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/react-dom": {
      "version": "18.3.1",
      "resolved": "https://registry.npmjs.org/react-dom/-/react-dom-18.3.1.tgz",
      "integrity": "sha512-5m4nQKp+rZRb09LNH59GM4BxTh9251/ylbKIbpe7TpGxfJ+9kv6BLkLBXIjjspbgbnIBNqlI23tRnTWT0snUIw==",
      "license": "MIT",
      "dependencies": {
        "loose-envify": "^1.1.0",
        "scheduler": "^0.23.2"
      },
      "peerDependencies": {
        "react": "^18.3.1"
      }
    },
    "node_modules/react-refresh": {
      "version": "0.17.0",
      "resolved": "https://registry.npmjs.org/react-refresh/-/react-refresh-0.17.0.tgz",
      "integrity": "sha512-z6F7K9bV85EfseRCp2bzrpyQ0Gkw1uLoCel9XBVWPg/TjRj94SkJzUTGfOa4bs7iJvBWtQG0Wq7wnI0syw3EBQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/react-router": {
      "version": "6.30.1",
      "resolved": "https://registry.npmjs.org/react-router/-/react-router-6.30.1.tgz",
      "integrity": "sha512-X1m21aEmxGXqENEPG3T6u0Th7g0aS4ZmoNynhbs+Cn+q+QGTLt+d5IQ2bHAXKzKcxGJjxACpVbnYQSCRcfxHlQ==",
      "license": "MIT",
      "dependencies": {
        "@remix-run/router": "1.23.0"
      },
      "engines": {
        "node": ">=14.0.0"
      },
      "peerDependencies": {
        "react": ">=16.8"
      }
    },
    "node_modules/react-router-dom": {
      "version": "6.30.1",
      "resolved": "https://registry.npmjs.org/react-router-dom/-/react-router-dom-6.30.1.tgz",
      "integrity": "sha512-llKsgOkZdbPU1Eg3zK8lCn+sjD9wMRZZPuzmdWWX5SUs8OFkN5HnFVC0u5KMeMaC9aoancFI/KoLuKPqN+hxHw==",
      "license": "MIT",
      "dependencies": {
        "@remix-run/router": "1.23.0",
        "react-router": "6.30.1"
      },
      "engines": {
        "node": ">=14.0.0"
      },
      "peerDependencies": {
        "react": ">=16.8",
        "react-dom": ">=16.8"
      }
    },
    "node_modules/rollup": {
      "version": "4.50.0",
      "resolved": "https://registry.npmjs.org/rollup/-/rollup-4.50.0.tgz",
      "integrity": "sha512-/Zl4D8zPifNmyGzJS+3kVoyXeDeT/GrsJM94sACNg9RtUE0hrHa1bNPtRSrfHTMH5HjRzce6K7rlTh3Khiw+pw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@types/estree": "1.0.8"
      },
      "bin": {
        "rollup": "dist/bin/rollup"
      },
      "engines": {
        "node": ">=18.0.0",
        "npm": ">=8.0.0"
      },
      "optionalDependencies": {
        "@rollup/rollup-android-arm-eabi": "4.50.0",
        "@rollup/rollup-android-arm64": "4.50.0",
        "@rollup/rollup-darwin-arm64": "4.50.0",
        "@rollup/rollup-darwin-x64": "4.50.0",
        "@rollup/rollup-freebsd-arm64": "4.50.0",
        "@rollup/rollup-freebsd-x64": "4.50.0",
        "@rollup/rollup-linux-arm-gnueabihf": "4.50.0",
        "@rollup/rollup-linux-arm-musleabihf": "4.50.0",
        "@rollup/rollup-linux-arm64-gnu": "4.50.0",
        "@rollup/rollup-linux-arm64-musl": "4.50.0",
        "@rollup/rollup-linux-loongarch64-gnu": "4.50.0",
        "@rollup/rollup-linux-ppc64-gnu": "4.50.0",
        "@rollup/rollup-linux-riscv64-gnu": "4.50.0",
        "@rollup/rollup-linux-riscv64-musl": "4.50.0",
        "@rollup/rollup-linux-s390x-gnu": "4.50.0",
        "@rollup/rollup-linux-x64-gnu": "4.50.0",
        "@rollup/rollup-linux-x64-musl": "4.50.0",
        "@rollup/rollup-openharmony-arm64": "4.50.0",
        "@rollup/rollup-win32-arm64-msvc": "4.50.0",
        "@rollup/rollup-win32-ia32-msvc": "4.50.0",
        "@rollup/rollup-win32-x64-msvc": "4.50.0",
        "fsevents": "~2.3.2"
      }
    },
    "node_modules/scheduler": {
      "version": "0.23.2",
      "resolved": "https://registry.npmjs.org/scheduler/-/scheduler-0.23.2.tgz",
      "integrity": "sha512-UOShsPwz7NrMUqhR6t0hWjFduvOzbtv7toDH1/hIrfRNIDBnnBWd0CwJTGvTpngVlmwGCdP9/Zl/tVrDqcuYzQ==",
      "license": "MIT",
      "dependencies": {
        "loose-envify": "^1.1.0"
      }
    },
    "node_modules/semver": {
      "version": "6.3.1",
      "resolved": "https://registry.npmjs.org/semver/-/semver-6.3.1.tgz",
      "integrity": "sha512-BR7VvDCVHO+q2xBEWskxS6DJE1qRnb7DxzUrogb71CWoSficBxYsiAGd+Kl0mmq/MprG9yArRkyrQxTO6XjMzA==",
      "dev": true,
      "license": "ISC",
      "bin": {
        "semver": "bin/semver.js"
      }
    },
    "node_modules/source-map-js": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/source-map-js/-/source-map-js-1.2.1.tgz",
      "integrity": "sha512-UXWMKhLOwVKb728IUtQPXxfYU+usdybtUrK/8uGE8CQMvrhOpwvzDBwj0QhSL7MQc7vIsISBG8VQ8+IDQxpfQA==",
      "dev": true,
      "license": "BSD-3-Clause",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/typescript": {
      "version": "5.9.2",
      "resolved": "https://registry.npmjs.org/typescript/-/typescript-5.9.2.tgz",
      "integrity": "sha512-CWBzXQrc/qOkhidw1OzBTQuYRbfyxDXJMVJ1XNwUHGROVmuaeiEm3OslpZ1RV96d7SKKjZKrSJu3+t/xlw3R9A==",
      "dev": true,
      "license": "Apache-2.0",
      "bin": {
        "tsc": "bin/tsc",
        "tsserver": "bin/tsserver"
      },
      "engines": {
        "node": ">=14.17"
      }
    },
    "node_modules/update-browserslist-db": {
      "version": "1.1.3",
      "resolved": "https://registry.npmjs.org/update-browserslist-db/-/update-browserslist-db-1.1.3.tgz",
      "integrity": "sha512-UxhIZQ+QInVdunkDAaiazvvT/+fXL5Osr0JZlJulepYu6Jd7qJtDZjlur0emRlT71EN3ScPoE7gvsuIKKNavKw==",
      "dev": true,
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/browserslist"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/browserslist"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "escalade": "^3.2.0",
        "picocolors": "^1.1.1"
      },
      "bin": {
        "update-browserslist-db": "cli.js"
      },
      "peerDependencies": {
        "browserslist": ">= 4.21.0"
      }
    },
    "node_modules/vite": {
      "version": "5.4.19",
      "resolved": "https://registry.npmjs.org/vite/-/vite-5.4.19.tgz",
      "integrity": "sha512-qO3aKv3HoQC8QKiNSTuUM1l9o/XX3+c+VTgLHbJWHZGeTPVAg2XwazI9UWzoxjIJCGCV2zU60uqMzjeLZuULqA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "esbuild": "^0.21.3",
        "postcss": "^8.4.43",
        "rollup": "^4.20.0"
      },
      "bin": {
        "vite": "bin/vite.js"
      },
      "engines": {
        "node": "^18.0.0 || >=20.0.0"
      },
      "funding": {
        "url": "https://github.com/vitejs/vite?sponsor=1"
      },
      "optionalDependencies": {
        "fsevents": "~2.3.3"
      },
      "peerDependencies": {
        "@types/node": "^18.0.0 || >=20.0.0",
        "less": "*",
        "lightningcss": "^1.21.0",
        "sass": "*",
        "sass-embedded": "*",
        "stylus": "*",
        "sugarss": "*",
        "terser": "^5.4.0"
      },
      "peerDependenciesMeta": {
        "@types/node": {
          "optional": true
        },
        "less": {
          "optional": true
        },
        "lightningcss": {
          "optional": true
        },
        "sass": {
          "optional": true
        },
        "sass-embedded": {
          "optional": true
        },
        "stylus": {
          "optional": true
        },
        "sugarss": {
          "optional": true
        },
        "terser": {
          "optional": true
        }
      }
    },
    "node_modules/yallist": {
      "version": "3.1.1",
      "resolved": "https://registry.npmjs.org/yallist/-/yallist-3.1.1.tgz",
      "integrity": "sha512-a4UGQaWPH59mOXUYnAG2ewncQS4i4F43Tv3JoAM+s2VDAmS9NsK8GpDMLrCHPksFT7h3K6TOoUNn2pb7RoXx4g==",
      "dev": true,
      "license": "ISC"
    }
  }
}


---
web\package.json

{
  "name": "erp-mvp-web",
  "private": true,
  "version": "0.0.1",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview --host"
  },
  "dependencies": {
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-router-dom": "^6.26.1"
  },
  "devDependencies": {
    "@types/react": "^18.3.8",
    "@types/react-dom": "^18.3.0",
    "@vitejs/plugin-react": "^4.3.1",
    "typescript": "^5.6.2",
    "vite": "^5.4.1"
  }
}


---
web\tsconfig.json

{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true
  },
  "include": ["src"]
}


---
web\vite.config.ts

import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";

export default defineConfig({
  plugins: [react()],
  server: {
    host: "0.0.0.0",
    port: 5173,
    proxy: {
      // La API expone /api/* y /health
      "/api": {
        target: "http://api:8000",
        changeOrigin: true,
      },
      "/health": {
        target: "http://api:8000",
        changeOrigin: true,
      },
    },
  },
});


---
web\src\api.ts

// src/api.ts
export interface Role { id: number; nombre: string; }
export interface User {
  id: number; email: string; nombre: string; apellido: string;
  roles: Role[]; activo: boolean;
}
export interface Tokens { access_token: string; refresh_token?: string; token_type?: string; expires_in?: number; }
export interface Project {
  id: number; uuid: string; codigo: string | null; nombre: string;
  estado: string; prioridad: number; avance_pct: number; presupuesto_monto: number;
}
export interface HealthResponse { status: string; db: string; version: string; }

const API_BASE =
  (import.meta as any).env?.VITE_API_URL ||
  window.location.origin.replace(':5173', ':8000');

const AT_KEY = 'erp.at';
const RT_KEY = 'erp.rt';

export const tokenStore = {
  get access() { return localStorage.getItem(AT_KEY) || ''; },
  set access(v: string) { localStorage.setItem(AT_KEY, v); },
  get refresh() { return localStorage.getItem(RT_KEY) || ''; },
  set refresh(v: string) { localStorage.setItem(RT_KEY, v); },
  clear() { localStorage.removeItem(AT_KEY); localStorage.removeItem(RT_KEY); }
};

async function refreshAccessToken(): Promise<string | null> {
  const rt = tokenStore.refresh;
  if (!rt) return null;
  const res = await fetch(`${API_BASE}/api/auth/refresh`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ refresh_token: rt })
  });
  if (!res.ok) return null;
  const data = await res.json() as Tokens;
  if (data.access_token) {
    tokenStore.access = data.access_token;
    return data.access_token;
  }
  return null;
}

async function request<T>(path: string, init?: RequestInit, retry = true): Promise<T> {
  const headers = new Headers(init?.headers || {});
  if (!headers.has('Content-Type') && init?.body) headers.set('Content-Type', 'application/json');
  const at = tokenStore.access;
  if (at) headers.set('Authorization', `Bearer ${at}`);

  const res = await fetch(`${API_BASE}${path}`, { ...init, headers });
  if (res.status === 401 && retry) {
    const newAT = await refreshAccessToken();
    if (newAT) {
      const headers2 = new Headers(init?.headers || {});
      if (!headers2.has('Content-Type') && init?.body) headers2.set('Content-Type', 'application/json');
      headers2.set('Authorization', `Bearer ${newAT}`);
      const res2 = await fetch(`${API_BASE}${path}`, { ...init, headers: headers2 });
      if (!res2.ok) throw new Error(`${res2.status} ${res2.statusText}`);
      return res2.json() as Promise<T>;
    }
  }
  if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
  return res.json() as Promise<T>;
}

export const api = {
  async login(email: string, password: string): Promise<User> {
    const res = await fetch(`${API_BASE}/api/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });
    if (!res.ok) throw new Error('Credenciales inv√°lidas');
    const data = await res.json() as Tokens & User; // login retorna tokens + (a veces user). Cubrimos tokens seguro.
    if (data.access_token) tokenStore.access = data.access_token;
    if (data.refresh_token) tokenStore.refresh = data.refresh_token;
    // Aseguramos el user llamando a /me:
    return this.me();
  },
  me(): Promise<User> {
    return request<User>('/api/auth/me');
  },
  health(): Promise<HealthResponse> {
    return request<HealthResponse>('/health', { method: 'GET' });
  },
  projects: {
    list(): Promise<Project[]> {
      return request<Project[]>('/api/projects', { method: 'GET' });
    },
    create(payload: { nombre: string; descripcion?: string }): Promise<Project> {
      return request<Project>('/api/projects', {
        method: 'POST',
        body: JSON.stringify(payload)
      });
    }
  }
};


---
web\src\App.tsx

// web/src/App.tsx
import { Route, Routes, Navigate } from "react-router-dom";
import Home from "./pages/Home";
import Login from "./pages/Login";
import Projects from "./pages/Projects";
import ProjectDetail from "./pages/ProjectDetail";
import Report from "./pages/Report";
import ProtectedRoute from "./components/ProtectedRoute";
import AppLayout from "./layouts/AppLayout";
import SimpleLayout from "./layouts/SimpleLayout";

export default function App() {
  return (
    <Routes>
      {/* Rutas p√∫blicas */}
      <Route element={<SimpleLayout />}>
        <Route path="/login" element={<Login />} />
      </Route>

      {/* Rutas privadas */}
      <Route element={<ProtectedRoute />}>
        <Route element={<AppLayout />}>
          <Route index element={<Home />} />
          <Route path="/projects" element={<Projects />} />
          <Route path="/projects/:id" element={<ProjectDetail />} />
          <Route path="/projects/:id/report" element={<Report />} />
        </Route>
      </Route>

      {/* Fallback */}
      <Route path="*" element={<Navigate to="/" replace />} />
    </Routes>
  );
}


---
web\src\authHelpers.ts

// src/auth.ts
import { api, tokenStore, User } from './api';

export type AuthState = {
  user: User | null;
  loading: boolean;
};

export async function doLogin(email: string, password: string): Promise<User> {
  const user = await api.login(email, password);
  return user;
}

export function doLogout() {
  tokenStore.clear();
  // Nada m√°s: el AuthContext se encargar√° de limpiar el user en memoria
}

export function hasRole(user: User | null, roleName: string): boolean {
  if (!user) return false;
  return (user.roles || []).some(r => r.nombre === roleName);
}


---
web\src\main.tsx

// web/src/main.tsx
import React from "react";
import ReactDOM from "react-dom/client";
import { BrowserRouter } from "react-router-dom";
import App from "./App";
import { AuthProvider } from "./auth/AuthContext";

ReactDOM.createRoot(document.getElementById("root")!).render(
  <React.StrictMode>
    <AuthProvider>
      <BrowserRouter>
        <App />
      </BrowserRouter>
    </AuthProvider>
  </React.StrictMode>
);


---
web\src\types.ts

export type Project = {
  id: number;
  uuid: string;
  codigo: string | null;
  nombre: string;
  estado: string;
  prioridad: number;
  avance_pct: number;
  presupuesto_monto: number;
};

export type Task = {
  id: number;
  proyecto_id: number;
  titulo: string;
  descripcion?: string | null;
  estado: "PENDIENTE" | "EN_PROGRESO" | "BLOQUEADA" | "HECHA";
  prioridad: number;
};

export type ResumenEstadoItem = {
  proyecto_id: number;
  proyecto: string;
  estado: string;
  cantidad: number;
};


---
web\src\api\auth.ts

import { apiFetch } from "./client";

export type Role = { id: number; nombre: string; activo: boolean };
export type User = {
  id: number; email: string; nombre: string; apellido: string;
  roles: Role[];
};

export async function login(email: string, password: string) {
  return apiFetch("/api/auth/login", {
    method: "POST",
    body: JSON.stringify({ email, password }),
  }) as Promise<{ access_token: string; refresh_token: string; user: User }>;
}

export async function me() {
  return apiFetch("/api/auth/me") as Promise<User>;
}


---
web\src\api\client.ts

const API_BASE = import.meta.env.VITE_API_URL || "http://localhost:8000";

function getToken() {
  return localStorage.getItem("access_token") || sessionStorage.getItem("access_token");
}

export async function apiFetch(path: string, init: RequestInit = {}) {
  const token = getToken();
  const headers = new Headers(init.headers || {});
  headers.set("Content-Type", "application/json");
  if (token) headers.set("Authorization", `Bearer ${token}`);

  const res = await fetch(`${API_BASE}${path}`, { ...init, headers });
  if (!res.ok) {
    const msg = await res.text().catch(() => "");
    throw new Error(msg || `HTTP ${res.status}`);
  }
  const ct = res.headers.get("content-type") || "";
  return ct.includes("application/json") ? res.json() : res.text();
}

export { API_BASE };


---
web\src\api\projects.ts

// web/src/api/projects.ts
import { apiFetch } from "./client";

export type Project = {
  id: number;
  uuid: string;
  codigo: string | null;
  nombre: string;
  estado: string;
  prioridad: number;
  avance_pct: number;
  presupuesto_monto: number;
};

export type Task = {
  id: number;
  proyecto_id: number;
  titulo: string;
  descripcion?: string | null;
  estado: "PENDIENTE" | "EN_PROGRESO" | "BLOQUEADA" | "HECHA";
  prioridad: number;
};

export async function getProjects(): Promise<Project[]> {
  return apiFetch<Project[]>("/api/projects");
}

export async function getProjectTasks(projectId: number): Promise<Task[]> {
  return apiFetch<Task[]>(`/api/projects/${projectId}/tasks`);
}

export async function createTask(input: {
  proyecto_id: number;
  titulo: string;
  descripcion?: string;
  prioridad?: number;
}): Promise<Task> {
  return apiFetch<Task>("/api/projects/tasks", {
    method: "POST",
    body: JSON.stringify(input),
  });
}

export async function updateTask(
  taskId: number,
  patch: Partial<Pick<Task, "titulo" | "descripcion" | "prioridad" | "estado">>
): Promise<Task> {
  return apiFetch<Task>(`/api/projects/tasks/${taskId}`, {
    method: "PATCH",
    body: JSON.stringify(patch),
  });
}


---
web\src\auth\AuthContext.tsx

// web/src/auth/AuthContext.tsx
import React, { createContext, useContext, useEffect, useMemo, useState } from "react";

export type User = {
  id: number;
  email: string;
  nombre?: string;
  apellido?: string;
  nombre_completo?: string;
  roles?: { nombre: string }[];
};

type AuthContextType = {
  user: User | null;
  loading: boolean;
  isAuthenticated: boolean;
  login: (email: string, password: string) => Promise<void>;
  logout: () => void;
  getAccessToken: () => Promise<string | null>;
};

const AuthContext = createContext<AuthContextType | null>(null);

const AT_KEY = "erp.at";
const RT_KEY = "erp.rt";
const API = import.meta.env.VITE_API_URL ?? "http://localhost:8000";

export const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [user, setUser] = useState<User | null>(null);
  const [accessToken, setAccessToken] = useState<string | null>(localStorage.getItem(AT_KEY));
  const [refreshToken, setRefreshToken] = useState<string | null>(localStorage.getItem(RT_KEY));
  const [accessExp, setAccessExp] = useState<number | null>(null);
  const [loading, setLoading] = useState(true);

  const saveTokens = (at: string, rt?: string, expiresIn?: number) => {
    setAccessToken(at);
    localStorage.setItem(AT_KEY, at);
    if (rt) {
      setRefreshToken(rt);
      localStorage.setItem(RT_KEY, rt);
    }
    if (expiresIn) setAccessExp(Date.now() + expiresIn * 1000);
  };

  const fetchMe = async (token: string) => {
    const res = await fetch(`${API}/api/auth/me`, { headers: { Authorization: `Bearer ${token}` } });
    if (!res.ok) throw new Error("Token inv√°lido");
    const u = (await res.json()) as User;
    setUser(u);
    return u;
  };

  const login = async (email: string, password: string) => {
    const res = await fetch(`${API}/api/auth/login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    });
    if (!res.ok) {
      const err = await res.json().catch(() => ({}));
      throw new Error(err?.detail || "Error de login");
    }
    const data = (await res.json()) as { access_token: string; refresh_token: string; expires_in: number; user: User };
    saveTokens(data.access_token, data.refresh_token, data.expires_in);
    await fetchMe(data.access_token);
  };

  const refresh = async (): Promise<string | null> => {
    if (!refreshToken) return null;
    const res = await fetch(`${API}/api/auth/refresh`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ refresh_token: refreshToken })
    });
    if (!res.ok) {
      logout();
      return null;
    }
    const data = (await res.json()) as { access_token: string; expires_in: number };
    saveTokens(data.access_token, undefined, data.expires_in);
    return data.access_token;
  };

  const getAccessToken = async () => {
    if (accessExp && accessExp - Date.now() < 60_000) {
      return await refresh();
    }
    return accessToken;
  };

  const logout = () => {
    localStorage.removeItem(AT_KEY);
    localStorage.removeItem(RT_KEY);
    setAccessToken(null);
    setRefreshToken(null);
    setAccessExp(null);
    setUser(null);
  };

  useEffect(() => {
    (async () => {
      try {
        const at = localStorage.getItem(AT_KEY);
        if (at) await fetchMe(at);
      } catch {
        logout();
      } finally {
        setLoading(false);
      }
    })();
  }, []);

  const value = useMemo<AuthContextType>(
    () => ({ user, loading, isAuthenticated: !!user, login, logout, getAccessToken }),
    [user, loading]
  );

  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
};

export const useAuth = () => {
  const ctx = useContext(AuthContext);
  if (!ctx) throw new Error("useAuth debe usarse dentro de <AuthProvider>");
  return ctx;
};


---
web\src\components\Layout.tsx

import React from "react";
import { Link, useNavigate } from "react-router-dom";
import { useAuth } from "../auth/AuthContext";

export default function Layout({ children }: { children: React.ReactNode }) {
  const { user, logout } = useAuth();
  const navigate = useNavigate();

  const onLogout = () => {
    logout();
    navigate("/login");
  };

  return (
    <div style={{ fontFamily: "system-ui, sans-serif", minHeight: "100vh", background: "#f6f7f9" }}>
      <header style={{ background: "#0f172a", color: "white", padding: "12px 16px", display: "flex", gap: 16, alignItems: "center" }}>
        <strong>ERP MVP</strong>
        <nav style={{ display: "flex", gap: 12 }}>
          <Link to="/" style={{ color: "white" }}>Inicio</Link>
          <Link to="/projects" style={{ color: "white" }}>Proyectos</Link>
        </nav>
        <div style={{ marginLeft: "auto", display: "flex", gap: 12, alignItems: "center" }}>
          {user && <span style={{ opacity: 0.8 }}>Hola, {user.nombre}</span>}
          <button onClick={onLogout} style={{ background: "transparent", border: "1px solid #94a3b8", color: "white", padding: "4px 10px", borderRadius: 6, cursor: "pointer" }}>
            Salir
          </button>
        </div>
      </header>
      <main style={{ maxWidth: 1100, margin: "20px auto", padding: "0 16px" }}>
        {children}
      </main>
    </div>
  );
}


---
web\src\components\Navbar.tsx

// src/components/Navbar.tsx
import React from 'react';
import { Link } from 'react-router-dom';
import { useAuth } from '../auth/AuthContext';

export default function Navbar() {
  const { user, logout } = useAuth();
  return (
    <nav style={{display:'flex',gap:12,padding:12,borderBottom:'1px solid #e5e5e5'}}>
      <Link to="/">Home</Link>
      <Link to="/projects">Projects</Link>
      <div style={{marginLeft:'auto'}} />
      {user ? (
        <>
          <span style={{opacity:.7}}>{user.nombre} {user.apellido}</span>
          <button onClick={logout} style={{marginLeft:12}}>Salir</button>
        </>
      ) : (
        <Link to="/login">Login</Link>
      )}
    </nav>
  );
}


---
web\src\components\ProtectedRoute.tsx

// web/src/components/ProtectedRoute.tsx
import { Navigate, Outlet, useLocation } from "react-router-dom";
import { useAuth } from "../auth/AuthContext";

export default function ProtectedRoute() {
  const { isAuthenticated, loading } = useAuth();
  const location = useLocation();

  if (loading) return null; // o un spinner suave
  if (!isAuthenticated) {
    return <Navigate to="/login" replace state={{ from: location }} />;
  }
  return <Outlet />;
}


---
web\src\components\TaskRow.tsx

import { Task } from "../types";
const ESTADOS = ["PENDIENTE", "EN_PROGRESO", "BLOQUEADA", "HECHA"] as const;

export default function TaskRow({
  task,
  onChangeEstado,
}: {
  task: Task;
  onChangeEstado: (estado: Task["estado"]) => void;
}) {
  return (
    <div className="flex items-center justify-between border rounded p-2">
      <div>
        <div className="font-medium">{task.titulo}</div>
        {task.descripcion && <div className="text-sm text-gray-600">{task.descripcion}</div>}
      </div>
      <div className="flex items-center gap-2">
        <label className="text-sm text-gray-600">Estado</label>
        <select
          className="border rounded p-1"
          value={task.estado}
          onChange={(e) => onChangeEstado(e.target.value as Task["estado"])}
        >
          {ESTADOS.map(e => <option key={e} value={e}>{e}</option>)}
        </select>
      </div>
    </div>
  );
}


---
web\src\layouts\AppLayout.tsx

import React from "react";
import { Outlet } from "react-router-dom";
import Navbar from "../components/Navbar";

export default function AppLayout() {
  return (
    <div>
      <Navbar />
      <main style={{ maxWidth: 1200, margin: "0 auto", padding: 16 }}>
        <Outlet />
      </main>
    </div>
  );
}


---
web\src\layouts\SimpleLayout.tsx

import React from "react";
import { Outlet } from "react-router-dom";

export default function SimpleLayout() {
  return (
    <div style={{ maxWidth: 960, margin: "0 auto", padding: 16 }}>
      <Outlet />
    </div>
  );
}


---
web\src\lib\api.ts

// web/src/lib/api.ts
const BASE = import.meta.env.VITE_API_URL || "http://localhost:8000";

type FetchOpts = RequestInit & { json?: any };

function buildHeaders(access?: string, extra?: HeadersInit): HeadersInit {
  const base: Record<string, string> = { "Content-Type": "application/json" };
  if (access) base.Authorization = `Bearer ${access}`;
  return { ...base, ...(extra || {}) }; // <-- correcci√≥n
}

function getAuthFromStorage() {
  try {
    return JSON.parse(localStorage.getItem("auth") || "{}");
  } catch {
    return {};
  }
}

function saveAuthToStorage(auth: any) {
  localStorage.setItem("auth", JSON.stringify(auth));
}

async function refreshAccessToken(refresh_token: string) {
  const res = await fetch(`${BASE}/api/auth/refresh`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ refresh_token }),
  });
  if (!res.ok) throw new Error("Refresh inv√°lido");
  const data = await res.json();
  return data as { access_token: string; expires_in: number; token_type: string };
}

/**
 * apiFetch ‚Äî hace fetch con Bearer y, si recibe 401, intenta 1 refresh y reintenta.
 * - Guarda el nuevo access_token en localStorage.auth
 * - Si falla el refresh, limpia sesi√≥n (auth) y lanza error
 */
export async function apiFetch<T = any>(path: string, opts: FetchOpts = {}): Promise<T> {
  const auth = getAuthFromStorage();
  const access = auth?.access_token as string | undefined;
  const refresh = auth?.refresh_token as string | undefined;

  const headers = buildHeaders(access, opts.headers);
  const body = opts.json !== undefined ? JSON.stringify(opts.json) : opts.body;

  let res = await fetch(`${BASE}${path}`, { ...opts, headers, body });

  if (res.status === 401 && refresh) {
    // intentar refresh una sola vez
    try {
      const r = await refreshAccessToken(refresh);
      const updated = { ...auth, access_token: r.access_token, expires_in: r.expires_in };
      saveAuthToStorage(updated);

      const retryHeaders = buildHeaders(r.access_token, opts.headers);
      res = await fetch(`${BASE}${path}`, { ...opts, headers: retryHeaders, body });
    } catch (e) {
      localStorage.removeItem("auth");
      throw new Error("Sesi√≥n expirada. Vuelve a iniciar sesi√≥n.");
    }
  }

  if (!res.ok) {
    // intentar parsear JSON de error, si existe
    let msg = res.statusText;
    try {
      const err = await res.json();
      msg = err?.detail || JSON.stringify(err);
    } catch {}
    throw new Error(msg || "Error de solicitud");
  }

  const ct = res.headers.get("content-type") || "";
  if (ct.includes("application/json")) {
    return (await res.json()) as T;
  }
  // por si alguna llamada devuelve vac√≠o
  return undefined as T;
}


---
web\src\pages\Home.tsx

import React, { useEffect, useState } from "react";
import { useAuth } from "../auth/AuthContext";

const API = import.meta.env.VITE_API_URL ?? "http://localhost:8000";

export default function Home() {
  const { user, getAccessToken } = useAuth();
  const [health, setHealth] = useState<string>("...");
  const [err, setErr] = useState<string | null>(null);

  useEffect(() => {
    const run = async () => {
      try {
        const res = await fetch(`${API}/health`);
        if (!res.ok) throw new Error("No se pudo obtener health");
        const data = await res.json();
        setHealth(`API: ${data.status} / DB: ${data.database} / v${data.version}`);
      } catch (e: any) {
        setErr(e?.message || "Error al consultar health");
      }
    };
    void run();
  }, []);

  return (
    <div>
      <h2>‚úÖ ERP MVP UI en vivo</h2>
      <p>Si ves esto, React est√° montado y Vite sirve la app.</p>
      <p><strong>Usuario:</strong> {user?.nombre_completo}</p>
      <h3>Health de API</h3>
      {err ? <p style={{ color: "#b91c1c" }}>‚ö†Ô∏è {err}</p> : <p>{health}</p>}
      <p style={{ opacity: .7, marginTop: 24 }}>Tip: naveg√° a ‚ÄúProyectos‚Äù en el header.</p>
    </div>
  );
}


---
web\src\pages\Login.tsx

// web/src/pages/Login.tsx
import React, { useState } from "react";
import { useLocation, useNavigate } from "react-router-dom";
import { useAuth } from "../auth/AuthContext"; // üëà corrige este path

export default function Login() {
  const { login } = useAuth();
  const nav = useNavigate();
  const location = useLocation() as any;
  const redirectTo = location.state?.from?.pathname || "/projects";

  const [email, setEmail] = useState("admin@miempresa.com");
  const [password, setPassword] = useState("admin123");
  const [loading, setLoading] = useState(false);
  const [err, setErr] = useState<string | null>(null);

  const onSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setErr(null);
    setLoading(true);
    try {
      await login(email, password);
      nav(redirectTo, { replace: true });
    } catch (ex: any) {
      setErr(ex?.message || "Error de autenticaci√≥n");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={{ minHeight: "100dvh", display: "grid", placeItems: "center", fontFamily: "system-ui, sans-serif" }}>
      <form onSubmit={onSubmit} style={{ width: 320, display: "grid", gap: 12 }}>
        <h2>Iniciar sesi√≥n</h2>
        <label style={{ display: "grid", gap: 6 }}>
          <span>Email</span>
          <input type="email" value={email} onChange={e => setEmail(e.target.value)} required style={{ padding: 10, borderRadius: 8, border: "1px solid #ddd" }} />
        </label>
        <label style={{ display: "grid", gap: 6 }}>
          <span>Contrase√±a</span>
          <input type="password" value={password} onChange={e => setPassword(e.target.value)} required style={{ padding: 10, borderRadius: 8, border: "1px solid #ddd" }} />
        </label>
        {err && <div style={{ color: "#b00" }}>{err}</div>}
        <button type="submit" disabled={loading} style={{ padding: "10px 14px", borderRadius: 8, background: "#111827", color: "white", border: "none", cursor: "pointer" }}>
          {loading ? "Entrando‚Ä¶" : "Entrar"}
        </button>
      </form>
    </div>
  );
}


---
web\src\pages\LoginPage.tsx

import React, { useState } from "react";
import { useAuth } from "../auth/AuthContext";
import { useNavigate, Navigate } from "react-router-dom";

export default function LoginPage() {
  const { isAuthenticated, login } = useAuth();
  const navigate = useNavigate();

  const [email, setEmail] = useState("admin@miempresa.com");
  const [password, setPassword] = useState("admin123");
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  if (isAuthenticated) return <Navigate to="/projects" replace />;

  const onSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    setError(null);
    try {
      await login(email, password);
      navigate("/projects", { replace: true });
    } catch (err: any) {
      setError(err?.message || "Error al iniciar sesi√≥n");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={{ maxWidth: 380, margin: "64px auto", padding: 24, border: "1px solid #eee", borderRadius: 12 }}>
      <h1 style={{ marginBottom: 8 }}>Ingresar</h1>
      <p style={{ color: "#666", marginTop: 0, marginBottom: 16 }}>
        Usa las credenciales seed del README.
      </p>

      {error && (
        <div style={{ background: "#fee", color: "#900", padding: "8px 12px", borderRadius: 8, marginBottom: 12 }}>
          {error}
        </div>
      )}

      <form onSubmit={onSubmit}>
        <div style={{ display: "grid", gap: 12 }}>
          <label>
            <div style={{ fontSize: 12, color: "#555" }}>Email</div>
            <input
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              type="email"
              required
              style={{ width: "100%", padding: 10, borderRadius: 8, border: "1px solid #ccc" }}
            />
          </label>
          <label>
            <div style={{ fontSize: 12, color: "#555" }}>Password</div>
            <input
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              type="password"
              required
              style={{ width: "100%", padding: 10, borderRadius: 8, border: "1px solid #ccc" }}
            />
          </label>
          <button
            type="submit"
            disabled={loading}
            style={{
              padding: "10px 14px",
              borderRadius: 8,
              border: "1px solid #333",
              background: loading ? "#ddd" : "#111",
              color: "#fff",
              cursor: loading ? "default" : "pointer"
            }}
          >
            {loading ? "Entrando..." : "Entrar"}
          </button>
        </div>
      </form>
    </div>
  );
}


---
web\src\pages\NotFoundPage.tsx

import React from "react";

export default function NotFoundPage() {
  return (
    <div style={{ padding: 24 }}>
      <h1>404</h1>
      <p>P√°gina no encontrada.</p>
    </div>
  );
}


---
web\src\pages\ProjectDetail.tsx

import React, { useEffect, useState } from "react";
import { useParams } from "react-router-dom";
import { useAuth } from "../auth/AuthContext";

type Tarea = {
  id: number;
  uuid: string;
  proyecto_id: number;
  titulo: string;
  estado: string;
  prioridad: number;
  real_horas?: number | null;
};

const API = import.meta.env.VITE_API_URL ?? "http://localhost:8000";

export default function ProjectDetail() {
  const { id } = useParams<{ id: string }>();
  const pid = Number(id);
  const { getAccessToken } = useAuth();
  const [items, setItems] = useState<Tarea[]>([]);
  const [err, setErr] = useState<string | null>(null);
  const [loading, setLoading] = useState(true);

  const load = async () => {
    setErr(null);
    setLoading(true);
    try {
      const at = await getAccessToken();
      const res = await fetch(`${API}/api/projects/${pid}/tasks`, {
        headers: { Authorization: `Bearer ${at}` }
      });
      if (!res.ok) throw new Error("No se pudieron obtener tareas");
      setItems(await res.json());
    } catch (e: any) {
      setErr(e?.message || "Error");
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => { void load(); }, []);

  const updateEstado = async (taskId: number, estado: string) => {
    try {
      const at = await getAccessToken();
      const res = await fetch(`${API}/api/projects/tasks/${taskId}`, {
        method: "PATCH",
        headers: { "Content-Type": "application/json", Authorization: `Bearer ${at}` },
        body: JSON.stringify({ estado })
      });
      if (!res.ok) throw new Error("No se pudo actualizar tarea");
      await load();
    } catch (e: any) {
      alert(e?.message || "Error al actualizar");
    }
  };

  return (
    <div>
      <h2>Proyecto #{pid} ¬∑ Tareas</h2>
      {loading && <p>Cargando...</p>}
      {err && <p style={{ color: "#b91c1c" }}>‚ö†Ô∏è {err}</p>}
      {!loading && !err && (
        <div style={{ overflowX: "auto" }}>
          <table style={{ width: "100%", borderCollapse: "collapse", background: "white", borderRadius: 12, overflow: "hidden" }}>
            <thead style={{ background: "#e2e8f0", textAlign: "left" }}>
              <tr>
                <th style={{ padding: 10 }}>#</th>
                <th style={{ padding: 10 }}>T√≠tulo</th>
                <th style={{ padding: 10 }}>Estado</th>
                <th style={{ padding: 10 }}>Prioridad</th>
                <th style={{ padding: 10 }}>Acciones</th>
              </tr>
            </thead>
            <tbody>
              {items.map(t => (
                <tr key={t.id} style={{ borderBottom: "1px solid #e2e8f0" }}>
                  <td style={{ padding: 10 }}>{t.id}</td>
                  <td style={{ padding: 10 }}>{t.titulo}</td>
                  <td style={{ padding: 10 }}>{t.estado}</td>
                  <td style={{ padding: 10 }}>{t.prioridad}</td>
                  <td style={{ padding: 10 }}>
                    <select value={t.estado} onChange={(e)=>updateEstado(t.id, e.target.value)}>
                      <option value="PENDIENTE">PENDIENTE</option>
                      <option value="EN_PROGRESO">EN_PROGRESO</option>
                      <option value="HECHA">HECHA</option>
                    </select>
                  </td>
                </tr>
              ))}
              {items.length === 0 && (
                <tr><td colSpan={5} style={{ padding: 10, textAlign: "center" }}>Sin tareas.</td></tr>
              )}
            </tbody>
          </table>
        </div>
      )}
    </div>
  );
}


---
web\src\pages\ProjectDetailsPage.tsx

// web/src/pages/ProjectDetailsPage.tsx
import { useEffect, useMemo, useState } from "react";
import { useParams } from "react-router-dom";
import { apiFetch } from "../lib/api";

type Proyecto = {
  id: number; nombre: string; codigo?: string | null; estado: string; prioridad: number;
};
type Tarea = {
  id: number; uuid: string; proyecto_id: number; titulo: string; estado: string; prioridad: number; real_horas?: number | null;
};
type ResumenItem = { proyecto_id: number; proyecto: string; estado: string; cantidad: number };

export default function ProjectDetailsPage() {
  const { id } = useParams();
  const pid = Number(id);
  const [p, setP] = useState<Proyecto | null>(null);
  const [tareas, setTareas] = useState<Tarea[]>([]);
  const [resumen, setResumen] = useState<ResumenItem[]>([]);
  const [loading, setLoading] = useState(true);
  const [err, setErr] = useState<string | null>(null);

  const [nueva, setNueva] = useState({ titulo: "", descripcion: "" });
  const [saving, setSaving] = useState(false);

  const agrupado = useMemo(() => {
    const map: Record<string, number> = {};
    resumen.forEach(r => { map[r.estado] = (map[r.estado] || 0) + r.cantidad; });
    return map;
  }, [resumen]);

  const load = async () => {
    setLoading(true); setErr(null);
    try {
      const [proy, ts, res] = await Promise.all([
        apiFetch<Proyecto>(`/api/projects/${pid}`),
        apiFetch<Tarea[]>(`/api/projects/${pid}/tasks`),
        apiFetch<ResumenItem[]>(`/api/projects/${pid}/report/estado`),
      ]);
      setP(proy); setTareas(ts); setResumen(res);
    } catch (e: any) {
      setErr(e.message || "Error al cargar");
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => { if (pid) load(); }, [pid]);

  const crearTarea = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!nueva.titulo.trim()) return;
    setSaving(true);
    try {
      await apiFetch<Tarea>("/api/projects/tasks", {
        method: "POST",
        json: { proyecto_id: pid, titulo: nueva.titulo, descripcion: nueva.descripcion || null, prioridad: 2 },
      });
      setNueva({ titulo: "", descripcion: "" });
      await load();
    } catch (e: any) {
      alert(e.message || "Error al crear tarea");
    } finally {
      setSaving(false);
    }
  };

  const cambiarEstado = async (t: Tarea, estado: string) => {
    try {
      await apiFetch<Tarea>(`/api/projects/tasks/${t.id}`, { method: "PATCH", json: { estado } });
      await load();
    } catch (e: any) {
      alert(e.message || "No se pudo cambiar estado");
    }
  };

  if (loading) return <div style={{ padding: 16 }}>Cargando...</div>;
  if (err) return <div style={{ padding: 16, color: "crimson" }}>{err}</div>;
  if (!p) return <div style={{ padding: 16 }}>Proyecto no encontrado</div>;

  return (
    <div style={{ maxWidth: 900, margin: "0 auto", padding: 16 }}>
      <h1>{p.nombre} {p.codigo ? <small style={{ color: "#666" }}>({p.codigo})</small> : null}</h1>
      <p>Estado: <b>{p.estado}</b> | Prioridad: {p.prioridad}</p>

      <section style={{ margin: "16px 0" }}>
        <h3>Reporte por estado</h3>
        {Object.keys(agrupado).length === 0 ? (
          <p>Sin datos</p>
        ) : (
          <ul>
            {Object.entries(agrupado).map(([k, v]) => (
              <li key={k}>{k}: {v}</li>
            ))}
          </ul>
        )}
      </section>

      <section style={{ margin: "16px 0" }}>
        <h3>Nueva tarea</h3>
        <form onSubmit={crearTarea} style={{ display: "grid", gap: 8, maxWidth: 500 }}>
          <input
            placeholder="T√≠tulo *"
            required
            value={nueva.titulo}
            onChange={(e) => setNueva({ ...nueva, titulo: e.target.value })}
          />
          <input
            placeholder="Descripci√≥n (opcional)"
            value={nueva.descripcion}
            onChange={(e) => setNueva({ ...nueva, descripcion: e.target.value })}
          />
          <button type="submit" disabled={saving}>{saving ? "Creando..." : "Crear tarea"}</button>
        </form>
      </section>

      <section style={{ margin: "16px 0" }}>
        <h3>Tareas</h3>
        <table width="100%" cellPadding={8} style={{ borderCollapse: "collapse" }}>
          <thead>
            <tr>
              <th align="left">ID</th>
              <th align="left">T√≠tulo</th>
              <th align="left">Estado</th>
              <th align="left">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {tareas.map((t) => (
              <tr key={t.id} style={{ borderTop: "1px solid #eee" }}>
                <td>{t.id}</td>
                <td>{t.titulo}</td>
                <td>{t.estado}</td>
                <td style={{ display: "flex", gap: 8 }}>
                  <button onClick={() => cambiarEstado(t, "PENDIENTE")}>Pendiente</button>
                  <button onClick={() => cambiarEstado(t, "EN_PROGRESO")}>En progreso</button>
                  <button onClick={() => cambiarEstado(t, "HECHA")}>Hecha</button>
                </td>
              </tr>
            ))}
            {tareas.length === 0 && (
              <tr><td colSpan={4} style={{ textAlign: "center", padding: 24 }}>Sin tareas</td></tr>
            )}
          </tbody>
        </table>
      </section>
    </div>
  );
}


---
web\src\pages\Projects.tsx

import React, { useEffect, useState } from "react";
import { Link } from "react-router-dom";
import { useAuth } from "../auth/AuthContext";

type Proyecto = {
  id: number;
  uuid: string;
  codigo?: string | null;
  nombre: string;
  estado: string;
  prioridad: number;
  avance_pct?: number | null;
  presupuesto_monto?: number | null;
};

const API = import.meta.env.VITE_API_URL ?? "http://localhost:8000";

export default function Projects() {
  const { getAccessToken } = useAuth();
  const [items, setItems] = useState<Proyecto[]>([]);
  const [err, setErr] = useState<string | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const run = async () => {
      setLoading(true);
      setErr(null);
      try {
        const at = await getAccessToken();
        const res = await fetch(`${API}/api/projects`, {
          headers: { Authorization: `Bearer ${at}` }
        });
        if (!res.ok) throw new Error("No se pudieron obtener proyectos");
        const data: Proyecto[] = await res.json();
        setItems(data);
      } catch (e: any) {
        setErr(e?.message || "Error");
      } finally {
        setLoading(false);
      }
    };
    void run();
  }, [getAccessToken]);

  return (
    <div>
      <h2>Proyectos</h2>
      {loading && <p>Cargando...</p>}
      {err && <p style={{ color: "#b91c1c" }}>‚ö†Ô∏è {err}</p>}
      {!loading && !err && (
        <div style={{ overflowX: "auto" }}>
          <table style={{ width: "100%", borderCollapse: "collapse", background: "white", borderRadius: 12, overflow: "hidden" }}>
            <thead style={{ background: "#e2e8f0", textAlign: "left" }}>
              <tr>
                <th style={{ padding: 10 }}>#</th>
                <th style={{ padding: 10 }}>C√≥digo</th>
                <th style={{ padding: 10 }}>Nombre</th>
                <th style={{ padding: 10 }}>Estado</th>
                <th style={{ padding: 10 }}>Prioridad</th>
                <th style={{ padding: 10 }}>Acciones</th>
              </tr>
            </thead>
            <tbody>
              {items.map(p => (
                <tr key={p.id} style={{ borderBottom: "1px solid #e2e8f0" }}>
                  <td style={{ padding: 10 }}>{p.id}</td>
                  <td style={{ padding: 10 }}>{p.codigo || "-"}</td>
                  <td style={{ padding: 10 }}>{p.nombre}</td>
                  <td style={{ padding: 10 }}>{p.estado}</td>
                  <td style={{ padding: 10 }}>{p.prioridad}</td>
                  <td style={{ padding: 10 }}>
                    <Link to={`/projects/${p.id}`}>Ver tareas</Link>{" ¬∑ "}
                    <Link to={`/projects/${p.id}/report`}>Reporte</Link>
                  </td>
                </tr>
              ))}
              {items.length === 0 && (
                <tr><td colSpan={6} style={{ padding: 10, textAlign: "center" }}>Sin proyectos visibles.</td></tr>
              )}
            </tbody>
          </table>
        </div>
      )}
    </div>
  );
}


---
web\src\pages\ProjectsPage.tsx

// web/src/pages/ProjectsPage.tsx
import { useEffect, useState } from "react";
import { Link } from "react-router-dom";
import { apiFetch } from "../lib/api";

type Proyecto = {
  id: number;
  uuid: string;
  codigo?: string | null;
  nombre: string;
  estado: string;
  prioridad: number;
  avance_pct?: number | null;
  presupuesto_monto?: number | null;
};

export default function ProjectsPage() {
  const [items, setItems] = useState<Proyecto[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [nuevo, setNuevo] = useState({ codigo: "", nombre: "", descripcion: "" });
  const [saving, setSaving] = useState(false);

  const load = async () => {
    setLoading(true);
    setError(null);
    try {
      const data = await apiFetch<Proyecto[]>("/api/projects");
      setItems(data);
    } catch (e: any) {
      setError(e.message || "Error al cargar proyectos");
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    load();
  }, []);

  const createProject = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!nuevo.nombre.trim()) return;
    setSaving(true);
    try {
      await apiFetch<Proyecto>("/api/projects", {
        method: "POST",
        json: {
          codigo: nuevo.codigo || null,
          nombre: nuevo.nombre,
          descripcion: nuevo.descripcion || null,
          prioridad: 2,
        },
      });
      setNuevo({ codigo: "", nombre: "", descripcion: "" });
      await load();
    } catch (e: any) {
      alert(e.message || "Error al crear proyecto");
    } finally {
      setSaving(false);
    }
  };

  return (
    <div style={{ maxWidth: 900, margin: "0 auto", padding: 16 }}>
      <h1>Proyectos</h1>

      <form onSubmit={createProject} style={{ display: "grid", gap: 8, marginBottom: 24 }}>
        <input
          placeholder="C√≥digo (opcional)"
          value={nuevo.codigo}
          onChange={(e) => setNuevo({ ...nuevo, codigo: e.target.value })}
        />
        <input
          placeholder="Nombre *"
          required
          value={nuevo.nombre}
          onChange={(e) => setNuevo({ ...nuevo, nombre: e.target.value })}
        />
        <input
          placeholder="Descripci√≥n (opcional)"
          value={nuevo.descripcion}
          onChange={(e) => setNuevo({ ...nuevo, descripcion: e.target.value })}
        />
        <button type="submit" disabled={saving}>
          {saving ? "Creando..." : "Crear proyecto"}
        </button>
      </form>

      {loading && <p>Cargando...</p>}
      {error && <p style={{ color: "crimson" }}>{error}</p>}

      {!loading && !error && (
        <table width="100%" cellPadding={8} style={{ borderCollapse: "collapse" }}>
          <thead>
            <tr>
              <th align="left">ID</th>
              <th align="left">C√≥digo</th>
              <th align="left">Nombre</th>
              <th align="left">Estado</th>
              <th align="left">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {items.map((p) => (
              <tr key={p.id} style={{ borderTop: "1px solid #eee" }}>
                <td>{p.id}</td>
                <td>{p.codigo || "-"}</td>
                <td>{p.nombre}</td>
                <td>{p.estado}</td>
                <td>
                  <Link to={`/projects/${p.id}`}>Ver</Link>
                </td>
              </tr>
            ))}
            {items.length === 0 && (
              <tr>
                <td colSpan={5} style={{ textAlign: "center", padding: 24 }}>
                  Sin proyectos
                </td>
              </tr>
            )}
          </tbody>
        </table>
      )}
    </div>
  );
}


---
web\src\pages\Report.tsx

import React, { useEffect, useState } from "react";
import { useParams } from "react-router-dom";
import { useAuth } from "../auth/AuthContext";

type Resumen = {
  proyecto_id: number;
  proyecto: string;
  estado: string;
  cantidad: number;
};

const API = import.meta.env.VITE_API_URL ?? "http://localhost:8000";

export default function Report() {
  const { id } = useParams<{ id: string }>();
  const pid = Number(id);
  const { getAccessToken } = useAuth();
  const [items, setItems] = useState<Resumen[]>([]);
  const [err, setErr] = useState<string | null>(null);

  useEffect(() => {
    const run = async () => {
      setErr(null);
      try {
        const at = await getAccessToken();
        const res = await fetch(`${API}/api/projects/${pid}/report/estado`, {
          headers: { Authorization: `Bearer ${at}` }
        });
        if (!res.ok) throw new Error("No se pudo obtener el reporte");
        setItems(await res.json());
      } catch (e: any) {
        setErr(e?.message || "Error");
      }
    };
    void run();
  }, [pid, getAccessToken]);

  const total = items.reduce((acc, it) => acc + it.cantidad, 0);

  return (
    <div>
      <h2>Reporte por estado ¬∑ Proyecto #{pid}</h2>
      {err && <p style={{ color: "#b91c1c" }}>‚ö†Ô∏è {err}</p>}
      {!err && (
        <>
          <ul>
            {items.map(x => (
              <li key={x.estado}>{x.estado}: <strong>{x.cantidad}</strong></li>
            ))}
          </ul>
          <p><strong>Total de tareas:</strong> {total}</p>
        </>
      )}
    </div>
  );
}


---
